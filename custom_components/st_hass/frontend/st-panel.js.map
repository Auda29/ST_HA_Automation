{"version":3,"file":"st-panel.js","sources":["../../../frontend/src/editor/st-language.ts","../../../frontend/src/editor/st-theme.ts","../../../frontend/src/online/state-manager.ts","../../../frontend/src/online/live-decorations.ts","../../../frontend/src/editor/st-editor.ts","../../../frontend/src/online/online-toolbar.ts","../../../frontend/src/parser/tokens.ts","../../../frontend/src/parser/lexer.ts","../../../frontend/src/parser/parser.ts","../../../frontend/src/parser/visitor.ts","../../../frontend/src/parser/index.ts","../../../frontend/src/panel/st-panel.ts","../../../frontend/src/index.ts"],"sourcesContent":["/**\r\n * Structured Text Language Support for CodeMirror 6\r\n */\r\n\r\nimport { StreamLanguage } from \"@codemirror/language\";\r\nimport { completeFromList } from \"@codemirror/autocomplete\";\r\n\r\n// ============================================================================\r\n// Token Definitions\r\n// ============================================================================\r\n\r\nexport const ST_KEYWORDS = [\r\n  \"PROGRAM\",\r\n  \"END_PROGRAM\",\r\n  \"FUNCTION\",\r\n  \"END_FUNCTION\",\r\n  \"FUNCTION_BLOCK\",\r\n  \"END_FUNCTION_BLOCK\",\r\n  \"VAR\",\r\n  \"VAR_INPUT\",\r\n  \"VAR_OUTPUT\",\r\n  \"VAR_IN_OUT\",\r\n  \"VAR_GLOBAL\",\r\n  \"END_VAR\",\r\n  \"CONSTANT\",\r\n  \"IF\",\r\n  \"THEN\",\r\n  \"ELSIF\",\r\n  \"ELSE\",\r\n  \"END_IF\",\r\n  \"CASE\",\r\n  \"OF\",\r\n  \"END_CASE\",\r\n  \"FOR\",\r\n  \"TO\",\r\n  \"BY\",\r\n  \"DO\",\r\n  \"END_FOR\",\r\n  \"WHILE\",\r\n  \"END_WHILE\",\r\n  \"REPEAT\",\r\n  \"UNTIL\",\r\n  \"END_REPEAT\",\r\n  \"EXIT\",\r\n  \"RETURN\",\r\n  \"CONTINUE\",\r\n  \"AND\",\r\n  \"OR\",\r\n  \"XOR\",\r\n  \"NOT\",\r\n  \"MOD\",\r\n  \"TRUE\",\r\n  \"FALSE\",\r\n  \"AT\",\r\n];\r\n\r\nexport const ST_TYPES = [\r\n  \"BOOL\",\r\n  \"BYTE\",\r\n  \"WORD\",\r\n  \"DWORD\",\r\n  \"LWORD\",\r\n  \"SINT\",\r\n  \"INT\",\r\n  \"DINT\",\r\n  \"LINT\",\r\n  \"USINT\",\r\n  \"UINT\",\r\n  \"UDINT\",\r\n  \"ULINT\",\r\n  \"REAL\",\r\n  \"LREAL\",\r\n  \"STRING\",\r\n  \"WSTRING\",\r\n  \"TIME\",\r\n  \"DATE\",\r\n  \"TIME_OF_DAY\",\r\n  \"DATE_AND_TIME\",\r\n  \"TOD\",\r\n  \"DT\",\r\n];\r\n\r\nexport const ST_BUILTINS = [\r\n  \"SEL\",\r\n  \"MUX\",\r\n  \"MAX\",\r\n  \"MIN\",\r\n  \"LIMIT\",\r\n  \"ABS\",\r\n  \"SQRT\",\r\n  \"LN\",\r\n  \"LOG\",\r\n  \"EXP\",\r\n  \"SIN\",\r\n  \"COS\",\r\n  \"TAN\",\r\n  \"TRUNC\",\r\n  \"ROUND\",\r\n  \"CEIL\",\r\n  \"FLOOR\",\r\n  \"TO_BOOL\",\r\n  \"TO_INT\",\r\n  \"TO_DINT\",\r\n  \"TO_REAL\",\r\n  \"TO_LREAL\",\r\n  \"TO_STRING\",\r\n  \"LEN\",\r\n  \"LEFT\",\r\n  \"RIGHT\",\r\n  \"MID\",\r\n  \"CONCAT\",\r\n  \"FIND\",\r\n];\r\n\r\nexport const ST_FUNCTION_BLOCKS = [\r\n  \"R_TRIG\",\r\n  \"F_TRIG\",\r\n  \"SR\",\r\n  \"RS\",\r\n  \"TON\",\r\n  \"TOF\",\r\n  \"TP\",\r\n  \"CTU\",\r\n  \"CTD\",\r\n  \"CTUD\",\r\n];\r\n\r\nexport const ST_PRAGMAS = [\r\n  \"trigger\",\r\n  \"no_trigger\",\r\n  \"persistent\",\r\n  \"transient\",\r\n  \"reset_on_restart\",\r\n  \"require_restore\",\r\n  \"mode\",\r\n  \"max_queued\",\r\n  \"max_parallel\",\r\n  \"throttle\",\r\n  \"debounce\",\r\n];\r\n\r\n// ============================================================================\r\n// Tokenizer (StreamLanguage)\r\n// ============================================================================\r\n\r\ninterface TokenizerState {\r\n  inBlockComment: boolean;\r\n}\r\n\r\nexport const stLanguage = StreamLanguage.define<TokenizerState>({\r\n  name: \"structuredtext\",\r\n\r\n  startState(): TokenizerState {\r\n    return { inBlockComment: false };\r\n  },\r\n\r\n  copyState(state: TokenizerState): TokenizerState {\r\n    return { inBlockComment: state.inBlockComment };\r\n  },\r\n\r\n  token(stream, state): string | null {\r\n    // Whitespace\r\n    if (stream.eatSpace()) return null;\r\n\r\n    // Block comment (* ... *)\r\n    if (stream.match(\"(*\")) {\r\n      state.inBlockComment = true;\r\n    }\r\n    if (state.inBlockComment) {\r\n      while (!stream.eol()) {\r\n        if (stream.match(\"*)\")) {\r\n          state.inBlockComment = false;\r\n          return \"comment\";\r\n        }\r\n        stream.next();\r\n      }\r\n      return \"comment\";\r\n    }\r\n\r\n    // Line comment //\r\n    if (stream.match(\"//\")) {\r\n      stream.skipToEnd();\r\n      return \"comment\";\r\n    }\r\n\r\n    // Pragmas {keyword} or {key: value}\r\n    if (stream.match(\"{\")) {\r\n      let depth = 1;\r\n      while (!stream.eol() && depth > 0) {\r\n        const ch = stream.next();\r\n        if (ch === \"{\") depth++;\r\n        if (ch === \"}\") depth--;\r\n      }\r\n      return \"meta\";\r\n    }\r\n\r\n    // String literals\r\n    if (stream.match(\"'\")) {\r\n      while (!stream.eol()) {\r\n        if (stream.next() === \"'\" && !stream.match(\"'\")) {\r\n          return \"string\";\r\n        }\r\n      }\r\n      return \"string\";\r\n    }\r\n\r\n    // Time literals T#...\r\n    if (stream.match(/T#[\\d_hmsdu]+/i) || stream.match(/TIME#[\\d_hmsdu]+/i)) {\r\n      return \"number\";\r\n    }\r\n\r\n    // Hex 16#, Binary 2#, Octal 8#\r\n    if (\r\n      stream.match(/16#[\\da-fA-F_]+/) ||\r\n      stream.match(/2#[01_]+/) ||\r\n      stream.match(/8#[0-7_]+/)\r\n    ) {\r\n      return \"number\";\r\n    }\r\n\r\n    // Real numbers\r\n    if (stream.match(/\\d+\\.\\d+([eE][+-]?\\d+)?/)) {\r\n      return \"number\";\r\n    }\r\n\r\n    // Integers\r\n    if (stream.match(/\\d+/)) {\r\n      return \"number\";\r\n    }\r\n\r\n    // Multi-char operators\r\n    if (\r\n      stream.match(\":=\") ||\r\n      stream.match(\"<=\") ||\r\n      stream.match(\">=\") ||\r\n      stream.match(\"<>\") ||\r\n      stream.match(\"=>\")\r\n    ) {\r\n      return \"operator\";\r\n    }\r\n\r\n    // I/O Addresses %I*, %Q*, %M*\r\n    if (stream.match(/%[IQM][XBWDLxbwdl]?\\*?/i)) {\r\n      return \"keyword\";\r\n    }\r\n\r\n    // Identifiers and keywords\r\n    if (stream.match(/[a-zA-Z_][a-zA-Z0-9_]*/)) {\r\n      const word = stream.current().toUpperCase();\r\n\r\n      if (ST_KEYWORDS.includes(word)) return \"keyword\";\r\n      if (ST_TYPES.includes(word)) return \"typeName\";\r\n      if (ST_BUILTINS.includes(word)) return \"function.standard\";\r\n      if (ST_FUNCTION_BLOCKS.includes(word)) return \"className\";\r\n\r\n      return \"variableName\";\r\n    }\r\n\r\n    // Single char operators/punctuation\r\n    if (stream.match(/[+\\-*=<>()[\\];:,.]/)) {\r\n      return \"operator\";\r\n    }\r\n\r\n    stream.next();\r\n    return null;\r\n  },\r\n\r\n  languageData: {\r\n    commentTokens: { line: \"//\", block: { open: \"(*\", close: \"*)\" } },\r\n    closeBrackets: { brackets: [\"(\", \"[\", \"{\", \"'\"] },\r\n  },\r\n});\r\n\r\n// ============================================================================\r\n// Autocompletion\r\n// ============================================================================\r\n\r\nexport const stCompletion = completeFromList([\r\n  ...ST_KEYWORDS.map((k) => ({ label: k, type: \"keyword\" })),\r\n  ...ST_TYPES.map((t) => ({ label: t, type: \"type\" })),\r\n  ...ST_BUILTINS.map((f) => ({ label: f, type: \"function\" })),\r\n  ...ST_FUNCTION_BLOCKS.map((fb) => ({ label: fb, type: \"class\" })),\r\n  ...ST_PRAGMAS.map((p) => ({\r\n    label: `{${p}}`,\r\n    type: \"keyword\",\r\n    detail: \"pragma\",\r\n  })),\r\n  {\r\n    label: \"PROGRAM\",\r\n    type: \"keyword\",\r\n    apply: \"PROGRAM ${name}\\nVAR\\n\\t\\nEND_VAR\\n\\n\\nEND_PROGRAM\",\r\n    detail: \"template\",\r\n  },\r\n  {\r\n    label: \"IF\",\r\n    type: \"keyword\",\r\n    apply: \"IF ${cond} THEN\\n\\t\\nEND_IF\",\r\n    detail: \"template\",\r\n  },\r\n]);\r\n\r\n// ============================================================================\r\n// Language Support Export\r\n// ============================================================================\r\n\r\nimport { LanguageSupport } from \"@codemirror/language\";\r\n\r\nexport function structuredText() {\r\n  return new LanguageSupport(stLanguage, [\r\n    stLanguage.data.of({ autocomplete: stCompletion }),\r\n  ]);\r\n}\r\n","/**\r\n * TwinCAT-inspired Dark Theme for ST Editor\r\n */\r\n\r\nimport { EditorView } from \"@codemirror/view\";\r\nimport { Extension } from \"@codemirror/state\";\r\nimport { HighlightStyle, syntaxHighlighting } from \"@codemirror/language\";\r\nimport { tags as t } from \"@lezer/highlight\";\r\n\r\n// Color Palette\r\nconst colors = {\r\n  bg: \"#1e1e1e\",\r\n  bgLight: \"#252526\",\r\n  fg: \"#d4d4d4\",\r\n  fgDim: \"#808080\",\r\n  keyword: \"#569cd6\",\r\n  type: \"#4ec9b0\",\r\n  function: \"#dcdcaa\",\r\n  variable: \"#9cdcfe\",\r\n  string: \"#ce9178\",\r\n  number: \"#b5cea8\",\r\n  comment: \"#6a9955\",\r\n  pragma: \"#c586c0\",\r\n  selection: \"#264f78\",\r\n  cursor: \"#aeafad\",\r\n  lineHighlight: \"#2a2d2e\",\r\n  gutterBg: \"#1e1e1e\",\r\n  gutterFg: \"#858585\",\r\n  border: \"#404040\",\r\n};\r\n\r\n// Editor Theme\r\nexport const stEditorTheme = EditorView.theme(\r\n  {\r\n    \"&\": {\r\n      color: colors.fg,\r\n      backgroundColor: colors.bg,\r\n      fontSize: \"14px\",\r\n      fontFamily: '\"Fira Code\", \"Consolas\", monospace',\r\n    },\r\n    \".cm-content\": {\r\n      caretColor: colors.cursor,\r\n    },\r\n    \".cm-cursor\": {\r\n      borderLeftColor: colors.cursor,\r\n      borderLeftWidth: \"2px\",\r\n    },\r\n    // Selection highlighting - semi-transparent so text remains visible\r\n    \"&.cm-focused .cm-selectionBackground\": {\r\n      backgroundColor: \"rgba(38, 79, 120, 0.5)\",\r\n    },\r\n    \".cm-selectionBackground\": {\r\n      backgroundColor: \"rgba(38, 79, 120, 0.5)\",\r\n    },\r\n    \"& .cm-selectionLayer .cm-selectionBackground\": {\r\n      backgroundColor: \"rgba(38, 79, 120, 0.5)\",\r\n    },\r\n    \".cm-selectionMatch\": {\r\n      backgroundColor: \"rgba(58, 61, 65, 0.5)\",\r\n    },\r\n    // Native selection fallback\r\n    \".cm-content ::selection\": {\r\n      backgroundColor: \"rgba(38, 79, 120, 0.5)\",\r\n    },\r\n    \".cm-line ::selection\": {\r\n      backgroundColor: \"rgba(38, 79, 120, 0.5)\",\r\n    },\r\n    \".cm-activeLine\": {\r\n      backgroundColor: colors.lineHighlight,\r\n    },\r\n    \".cm-gutters\": {\r\n      backgroundColor: colors.gutterBg,\r\n      color: colors.gutterFg,\r\n      border: \"none\",\r\n      borderRight: `1px solid ${colors.border}`,\r\n    },\r\n    \".cm-activeLineGutter\": {\r\n      backgroundColor: colors.lineHighlight,\r\n      color: colors.fg,\r\n    },\r\n    \".cm-foldGutter .cm-gutterElement\": {\r\n      cursor: \"pointer\",\r\n    },\r\n    \".cm-tooltip\": {\r\n      backgroundColor: colors.bgLight,\r\n      border: `1px solid ${colors.border}`,\r\n    },\r\n    \".cm-tooltip-autocomplete ul li[aria-selected]\": {\r\n      backgroundColor: colors.selection,\r\n    },\r\n  },\r\n  { dark: true },\r\n);\r\n\r\n// Syntax Highlighting\r\nexport const stHighlightStyle = HighlightStyle.define([\r\n  { tag: t.keyword, color: colors.keyword, fontWeight: \"bold\" },\r\n  { tag: t.typeName, color: colors.type },\r\n  {\r\n    tag: [t.function(t.variableName), t.standard(t.function(t.variableName))],\r\n    color: colors.function,\r\n  },\r\n  { tag: t.className, color: colors.type },\r\n  { tag: t.variableName, color: colors.variable },\r\n  { tag: t.propertyName, color: colors.variable },\r\n  { tag: t.string, color: colors.string },\r\n  { tag: t.number, color: colors.number },\r\n  { tag: t.comment, color: colors.comment, fontStyle: \"italic\" },\r\n  { tag: t.meta, color: colors.pragma },\r\n  { tag: t.operator, color: colors.fg },\r\n  { tag: t.invalid, color: \"#ff0000\", textDecoration: \"underline wavy\" },\r\n]);\r\n\r\n// Combined Theme Export\r\nexport function stTheme(): Extension {\r\n  return [stEditorTheme, syntaxHighlighting(stHighlightStyle)];\r\n}\r\n","/**\r\n * Entity State Manager for Online Mode\r\n *\r\n * Manages WebSocket subscriptions and entity state updates.\r\n */\r\n\r\nimport { subscribeEntities } from \"home-assistant-js-websocket\";\r\nimport type { HassEntities } from \"home-assistant-js-websocket\";\r\nimport type {\r\n  EntityState,\r\n  VariableBinding,\r\n  LiveValue,\r\n  ParsedValue,\r\n  OnlineModeState,\r\n  OnlineStatus,\r\n} from \"./types\";\r\n\r\n// ============================================================================\r\n// State Manager\r\n// ============================================================================\r\n\r\nexport class OnlineStateManager {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  private readonly connection: any; // HomeAssistant WebSocket connection\r\n  private readonly bindings: Map<string, VariableBinding> = new Map();\r\n  private readonly entityStates: Map<string, EntityState> = new Map();\r\n  private readonly liveValues: Map<string, LiveValue> = new Map();\r\n  private readonly subscribers: Set<(state: OnlineModeState) => void> =\r\n    new Set();\r\n  private unsubscribe: (() => void) | null = null;\r\n\r\n  private status: OnlineStatus = \"disconnected\";\r\n  private updateRate: number = 100;\r\n  private showConditions: boolean = true;\r\n  private highlightChanges: boolean = true;\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  constructor(connection: any) {\r\n    this.connection = connection;\r\n  }\r\n\r\n  /**\r\n   * Start online mode with given variable bindings\r\n   */\r\n  async start(bindings: VariableBinding[]): Promise<void> {\r\n    this.status = \"connecting\";\r\n    this.notifySubscribers();\r\n\r\n    // Store bindings\r\n    this.bindings.clear();\r\n    for (const binding of bindings) {\r\n      this.bindings.set(binding.variableName, binding);\r\n    }\r\n\r\n    try {\r\n      // Subscribe to entity state changes using the imported function\r\n      this.unsubscribe = subscribeEntities(\r\n        this.connection,\r\n        (entities: HassEntities) => {\r\n          this.handleHassEntityUpdate(entities);\r\n        },\r\n      );\r\n\r\n      this.status = \"online\";\r\n      this.notifySubscribers();\r\n    } catch (error) {\r\n      this.status = \"error\";\r\n      this.notifySubscribers();\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop online mode\r\n   */\r\n  stop(): void {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n      this.unsubscribe = null;\r\n    }\r\n    this.status = \"disconnected\";\r\n    this.liveValues.clear();\r\n    this.notifySubscribers();\r\n  }\r\n\r\n  /**\r\n   * Pause/resume updates\r\n   */\r\n  setPaused(paused: boolean): void {\r\n    this.status = paused ? \"paused\" : \"online\";\r\n    this.notifySubscribers();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to state changes\r\n   */\r\n  subscribe(callback: (state: OnlineModeState) => void): () => void {\r\n    this.subscribers.add(callback);\r\n    return () => this.subscribers.delete(callback);\r\n  }\r\n\r\n  /**\r\n   * Get current state\r\n   */\r\n  getState(): OnlineModeState {\r\n    return {\r\n      status: this.status,\r\n      bindings: Array.from(this.bindings.values()),\r\n      liveValues: this.liveValues,\r\n      updateRate: this.updateRate,\r\n      showConditions: this.showConditions,\r\n      highlightChanges: this.highlightChanges,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get live value for a variable\r\n   */\r\n  getLiveValue(variableName: string): LiveValue | null {\r\n    return this.liveValues.get(variableName) || null;\r\n  }\r\n\r\n  // ==========================================================================\r\n  // Internal Methods\r\n  // ==========================================================================\r\n\r\n  /**\r\n   * Handle entity updates from home-assistant-js-websocket\r\n   * Converts HassEntities to our internal EntityState format\r\n   */\r\n  private handleHassEntityUpdate(entities: HassEntities): void {\r\n    if (this.status === \"paused\") return;\r\n\r\n    // Convert HassEntities to our EntityState format\r\n    const converted: Record<string, EntityState> = {};\r\n    for (const [entityId, hassEntity] of Object.entries(entities)) {\r\n      converted[entityId] = {\r\n        entityId: hassEntity.entity_id,\r\n        state: hassEntity.state,\r\n        lastChanged: hassEntity.last_changed,\r\n        attributes: hassEntity.attributes,\r\n      };\r\n    }\r\n\r\n    this.handleEntityUpdate(converted);\r\n  }\r\n\r\n  private handleEntityUpdate(entities: Record<string, EntityState>): void {\r\n    if (this.status === \"paused\") return;\r\n\r\n    const now = Date.now();\r\n\r\n    // Update entity states\r\n    for (const [entityId, state] of Object.entries(entities)) {\r\n      this.entityStates.set(entityId, state);\r\n    }\r\n\r\n    // Update live values for bound variables\r\n    for (const [varName, binding] of this.bindings) {\r\n      const entityState = this.entityStates.get(binding.entityId);\r\n      if (!entityState) continue;\r\n\r\n      const currentValue = this.parseValue(entityState.state, binding.dataType);\r\n      const existingLive = this.liveValues.get(varName);\r\n\r\n      const liveValue: LiveValue = {\r\n        binding,\r\n        currentValue,\r\n        previousValue: existingLive?.currentValue,\r\n        hasChanged: existingLive\r\n          ? existingLive.currentValue.raw !== currentValue.raw\r\n          : false,\r\n        lastUpdate: now,\r\n      };\r\n\r\n      this.liveValues.set(varName, liveValue);\r\n    }\r\n\r\n    this.notifySubscribers();\r\n  }\r\n\r\n  private parseValue(raw: string, expectedType: string): ParsedValue {\r\n    const invalid = [\"unavailable\", \"unknown\", \"none\", \"\"];\r\n\r\n    if (invalid.includes(raw.toLowerCase())) {\r\n      return {\r\n        raw,\r\n        formatted: \"窶能",\r\n        isValid: false,\r\n        dataType: \"UNKNOWN\",\r\n      };\r\n    }\r\n\r\n    switch (expectedType.toUpperCase()) {\r\n      case \"BOOL\": {\r\n        const boolValue = [\"on\", \"true\", \"1\"].includes(raw.toLowerCase());\r\n        return {\r\n          raw,\r\n          formatted: boolValue ? \"TRUE\" : \"FALSE\",\r\n          isValid: true,\r\n          dataType: \"BOOL\",\r\n        };\r\n      }\r\n\r\n      case \"INT\":\r\n      case \"DINT\": {\r\n        const intValue = Number.parseInt(raw, 10);\r\n        return {\r\n          raw,\r\n          formatted: Number.isNaN(intValue) ? \"窶能" : String(intValue),\r\n          isValid: !Number.isNaN(intValue),\r\n          dataType: \"INT\",\r\n        };\r\n      }\r\n\r\n      case \"REAL\":\r\n      case \"LREAL\": {\r\n        const floatValue = Number.parseFloat(raw);\r\n        return {\r\n          raw,\r\n          formatted: Number.isNaN(floatValue) ? \"窶能" : floatValue.toFixed(2),\r\n          isValid: !Number.isNaN(floatValue),\r\n          dataType: \"REAL\",\r\n        };\r\n      }\r\n\r\n      case \"STRING\":\r\n        return {\r\n          raw,\r\n          formatted: raw.length > 20 ? raw.substring(0, 17) + \"...\" : raw,\r\n          isValid: true,\r\n          dataType: \"STRING\",\r\n        };\r\n\r\n      case \"TIME\":\r\n        return {\r\n          raw,\r\n          formatted: raw,\r\n          isValid: true,\r\n          dataType: \"TIME\",\r\n        };\r\n\r\n      default:\r\n        return {\r\n          raw,\r\n          formatted: raw,\r\n          isValid: true,\r\n          dataType: \"UNKNOWN\",\r\n        };\r\n    }\r\n  }\r\n\r\n  private notifySubscribers(): void {\r\n    const state = this.getState();\r\n    for (const callback of this.subscribers) {\r\n      callback(state);\r\n    }\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// Value Formatter\r\n// ============================================================================\r\n\r\nexport class ValueFormatter {\r\n  /**\r\n   * Format value for display with appropriate styling\r\n   */\r\n  static format(value: ParsedValue): { text: string; className: string } {\r\n    if (!value.isValid) {\r\n      return { text: value.formatted, className: \"st-live-value--invalid\" };\r\n    }\r\n\r\n    switch (value.dataType) {\r\n      case \"BOOL\":\r\n        return {\r\n          text: value.formatted,\r\n          className:\r\n            value.formatted === \"TRUE\"\r\n              ? \"st-live-value--bool-true\"\r\n              : \"st-live-value--bool-false\",\r\n        };\r\n\r\n      case \"INT\":\r\n        return { text: value.formatted, className: \"st-live-value--int\" };\r\n\r\n      case \"REAL\":\r\n        return { text: value.formatted, className: \"st-live-value--real\" };\r\n\r\n      case \"STRING\":\r\n        return {\r\n          text: `\"${value.formatted}\"`,\r\n          className: \"st-live-value--string\",\r\n        };\r\n\r\n      default:\r\n        return { text: value.formatted, className: \"st-live-value--unknown\" };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format with change highlight\r\n   */\r\n  static formatWithChange(live: LiveValue): {\r\n    text: string;\r\n    className: string;\r\n  } {\r\n    const base = this.format(live.currentValue);\r\n\r\n    if (live.hasChanged) {\r\n      base.className += \" st-live-value--changed\";\r\n    }\r\n\r\n    return base;\r\n  }\r\n}\r\n","/**\r\n * CodeMirror Live Value Decorations\r\n *\r\n * Adds inline widgets showing live values next to variables.\r\n */\r\n\r\nimport {\r\n  EditorView,\r\n  Decoration,\r\n  DecorationSet,\r\n  WidgetType,\r\n} from \"@codemirror/view\";\r\nimport { StateField, StateEffect, Extension } from \"@codemirror/state\";\r\nimport type { LiveValue, OnlineModeState } from \"./types\";\r\nimport { ValueFormatter } from \"./state-manager\";\r\n\r\n// ============================================================================\r\n// State Effects\r\n// ============================================================================\r\n\r\nexport const setLiveValuesEffect = StateEffect.define<Map<string, LiveValue>>();\r\nexport const setOnlineStatusEffect = StateEffect.define<OnlineModeState[\"status\"]>();\r\n\r\n// ============================================================================\r\n// Live Value Widget\r\n// ============================================================================\r\n\r\nclass LiveValueWidget extends WidgetType {\r\n  constructor(\r\n    private readonly value: LiveValue,\r\n    private readonly showChange: boolean,\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  toDOM(): HTMLElement {\r\n    const wrapper = document.createElement(\"span\");\r\n    wrapper.className = \"st-live-value-widget\";\r\n\r\n    const formatted = this.showChange\r\n      ? ValueFormatter.formatWithChange(this.value)\r\n      : ValueFormatter.format(this.value.currentValue);\r\n\r\n    const valueSpan = document.createElement(\"span\");\r\n    valueSpan.className = `st-live-value ${formatted.className}`;\r\n    valueSpan.textContent = formatted.text;\r\n\r\n    // Add tooltip with entity ID\r\n    valueSpan.title = `${this.value.binding.entityId}\\nLast update: ${new Date(this.value.lastUpdate).toLocaleTimeString()}`;\r\n\r\n    wrapper.appendChild(valueSpan);\r\n    return wrapper;\r\n  }\r\n\r\n  eq(other: LiveValueWidget): boolean {\r\n    return (\r\n      this.value.currentValue.raw === other.value.currentValue.raw &&\r\n      this.value.hasChanged === other.value.hasChanged\r\n    );\r\n  }\r\n\r\n  ignoreEvent(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// Decoration State Field\r\n// ============================================================================\r\n\r\nconst liveValueDecorations = StateField.define<DecorationSet>({\r\n  create() {\r\n    return Decoration.none;\r\n  },\r\n\r\n  update(decorations, tr) {\r\n    // Check for live value updates\r\n    for (const effect of tr.effects) {\r\n      if (effect.is(setLiveValuesEffect)) {\r\n        return buildDecorations(tr.state.doc.toString(), effect.value);\r\n      }\r\n    }\r\n\r\n    // Map decorations through document changes\r\n    if (tr.docChanged) {\r\n      decorations = decorations.map(tr.changes);\r\n    }\r\n\r\n    return decorations;\r\n  },\r\n\r\n  provide: (field) => EditorView.decorations.from(field),\r\n});\r\n\r\n// ============================================================================\r\n// Build Decorations\r\n// ============================================================================\r\n\r\nfunction buildDecorations(\r\n  doc: string,\r\n  liveValues: Map<string, LiveValue>,\r\n): DecorationSet {\r\n  const decorations: Array<{ from: number; to: number; decoration: Decoration }> = [];\r\n  const lines = doc.split(\"\\n\");\r\n  let pos = 0;\r\n\r\n  for (let lineNum = 0; lineNum < lines.length; lineNum++) {\r\n    const line = lines[lineNum];\r\n    const lineEnd = pos + line.length;\r\n\r\n    // Find variable declarations on this line\r\n    for (const [, liveValue] of liveValues) {\r\n      if (liveValue.binding.line === lineNum + 1) {\r\n        // Add widget at end of line\r\n        const widget = Decoration.widget({\r\n          widget: new LiveValueWidget(liveValue, true),\r\n          side: 1,\r\n        });\r\n\r\n        decorations.push({\r\n          from: lineEnd,\r\n          to: lineEnd,\r\n          decoration: widget,\r\n        });\r\n      }\r\n    }\r\n\r\n    pos = lineEnd + 1; // +1 for newline\r\n  }\r\n\r\n  // Sort by position and create DecorationSet\r\n  decorations.sort((a, b) => a.from - b.from);\r\n  return Decoration.set(\r\n    decorations.map((d) => d.decoration.range(d.from, d.to)),\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// CSS Styles\r\n// ============================================================================\r\n\r\nexport const liveValueStyles = EditorView.baseTheme({\r\n  \".st-live-value-widget\": {\r\n    marginLeft: \"16px\",\r\n    display: \"inline-flex\",\r\n    alignItems: \"center\",\r\n  },\r\n\r\n  \".st-live-value\": {\r\n    padding: \"2px 8px\",\r\n    borderRadius: \"4px\",\r\n    fontFamily: \"monospace\",\r\n    fontSize: \"12px\",\r\n    fontWeight: \"500\",\r\n    backgroundColor: \"var(--st-live-bg, #2d2d30)\",\r\n    border: \"1px solid var(--st-live-border, #3c3c3c)\",\r\n    minWidth: \"60px\",\r\n    textAlign: \"right\",\r\n  },\r\n\r\n  \".st-live-value--bool-true\": {\r\n    color: \"#4ec9b0\",\r\n    backgroundColor: \"rgba(78, 201, 176, 0.1)\",\r\n    borderColor: \"#4ec9b0\",\r\n  },\r\n\r\n  \".st-live-value--bool-false\": {\r\n    color: \"#808080\",\r\n    backgroundColor: \"rgba(128, 128, 128, 0.1)\",\r\n    borderColor: \"#808080\",\r\n  },\r\n\r\n  \".st-live-value--int\": {\r\n    color: \"#b5cea8\",\r\n  },\r\n\r\n  \".st-live-value--real\": {\r\n    color: \"#dcdcaa\",\r\n  },\r\n\r\n  \".st-live-value--string\": {\r\n    color: \"#ce9178\",\r\n  },\r\n\r\n  \".st-live-value--invalid\": {\r\n    color: \"#f44747\",\r\n    fontStyle: \"italic\",\r\n  },\r\n\r\n  \".st-live-value--changed\": {\r\n    animation: \"st-value-flash 0.5s ease-out\",\r\n    boxShadow: \"0 0 4px var(--st-change-glow, #569cd6)\",\r\n  },\r\n\r\n  \"@keyframes st-value-flash\": {\r\n    \"0%\": { backgroundColor: \"rgba(86, 156, 214, 0.3)\" },\r\n    \"100%\": { backgroundColor: \"var(--st-live-bg, #2d2d30)\" },\r\n  },\r\n});\r\n\r\n// ============================================================================\r\n// Extension Export\r\n// ============================================================================\r\n\r\nexport function liveValuesExtension(): Extension {\r\n  return [liveValueDecorations, liveValueStyles];\r\n}\r\n\r\n// ============================================================================\r\n// Update Helper\r\n// ============================================================================\r\n\r\nexport function updateLiveValues(\r\n  view: EditorView,\r\n  liveValues: Map<string, LiveValue>,\r\n): void {\r\n  view.dispatch({\r\n    effects: setLiveValuesEffect.of(liveValues),\r\n  });\r\n}\r\n","/**\r\n * ST Editor Web Component (CodeMirror 6 Wrapper)\r\n */\r\n\r\nimport { LitElement, html, css, PropertyValues } from \"lit\";\r\nimport { customElement, property } from \"lit/decorators.js\";\r\nimport { EditorState, Extension, Compartment } from \"@codemirror/state\";\r\nimport {\r\n  EditorView,\r\n  keymap,\r\n  lineNumbers,\r\n  highlightActiveLineGutter,\r\n  highlightSpecialChars,\r\n  drawSelection,\r\n  highlightActiveLine,\r\n} from \"@codemirror/view\";\r\nimport {\r\n  defaultKeymap,\r\n  history,\r\n  historyKeymap,\r\n  indentWithTab,\r\n} from \"@codemirror/commands\";\r\nimport {\r\n  indentOnInput,\r\n  bracketMatching,\r\n  foldGutter,\r\n  foldKeymap,\r\n} from \"@codemirror/language\";\r\nimport {\r\n  closeBrackets,\r\n  autocompletion,\r\n  closeBracketsKeymap,\r\n  completionKeymap,\r\n} from \"@codemirror/autocomplete\";\r\nimport { highlightSelectionMatches, searchKeymap } from \"@codemirror/search\";\r\n\r\nimport { structuredText } from \"./st-language\";\r\nimport { stTheme } from \"./st-theme\";\r\nimport {\r\n  liveValuesExtension,\r\n  updateLiveValues,\r\n} from \"../online/live-decorations\";\r\nimport { OnlineStateManager } from \"../online/state-manager\";\r\nimport type { VariableBinding, OnlineModeState } from \"../online/types\";\r\n\r\n@customElement(\"st-editor\")\r\nexport class STEditor extends LitElement {\r\n  @property({ type: String }) declare code: string;\r\n  @property({ type: Boolean, attribute: \"read-only\" })\r\n  declare readOnly: boolean;\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  @property({ attribute: false }) declare hass?: any;\r\n\r\n  private _editor: EditorView | null = null;\r\n  private _readOnlyCompartment = new Compartment();\r\n  private _onlineManager: OnlineStateManager | null = null;\r\n  private _onlineUnsubscribe: (() => void) | null = null;\r\n\r\n  static styles = css`\r\n    :host {\r\n      display: block;\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n    #editor-container {\r\n      width: 100%;\r\n      height: 100%;\r\n      overflow: hidden;\r\n      border-radius: 4px;\r\n    }\r\n    #editor-container .cm-editor {\r\n      height: 100%;\r\n    }\r\n    #editor-container .cm-scroller {\r\n      overflow: auto;\r\n    }\r\n    /* Ensure selection highlighting is visible but not covering text */\r\n    #editor-container .cm-selectionBackground {\r\n      background-color: rgba(38, 79, 120, 0.5) !important;\r\n    }\r\n    #editor-container .cm-focused .cm-selectionBackground {\r\n      background-color: rgba(38, 79, 120, 0.5) !important;\r\n    }\r\n    #editor-container .cm-selectionLayer .cm-selectionBackground {\r\n      background-color: rgba(38, 79, 120, 0.5) !important;\r\n    }\r\n    /* Native selection as fallback */\r\n    #editor-container .cm-content ::selection {\r\n      background-color: rgba(38, 79, 120, 0.5) !important;\r\n    }\r\n    #editor-container .cm-line ::selection {\r\n      background-color: rgba(38, 79, 120, 0.5) !important;\r\n    }\r\n  `;\r\n\r\n  constructor() {\r\n    super();\r\n    this.code = \"\";\r\n    this.readOnly = false;\r\n  }\r\n\r\n  protected async firstUpdated(\r\n    _changedProperties: PropertyValues,\r\n  ): Promise<void> {\r\n    console.log(\"STEditor.firstUpdated called\");\r\n    // Wait for the update to complete, then initialize editor\r\n    await this.updateComplete;\r\n    console.log(\"STEditor: updateComplete resolved\");\r\n    // Additional frame to ensure DOM is painted\r\n    await new Promise((resolve) => requestAnimationFrame(resolve));\r\n    console.log(\"STEditor: requestAnimationFrame resolved\");\r\n    this._initEditor();\r\n  }\r\n\r\n  protected updated(changedProperties: PropertyValues): void {\r\n    if (changedProperties.has(\"readOnly\") && this._editor) {\r\n      this._editor.dispatch({\r\n        effects: this._readOnlyCompartment.reconfigure(\r\n          EditorState.readOnly.of(this.readOnly),\r\n        ),\r\n      });\r\n    }\r\n    if (changedProperties.has(\"code\") && this._editor) {\r\n      const currentCode = this._editor.state.doc.toString();\r\n      if (currentCode !== this.code) {\r\n        this._editor.dispatch({\r\n          changes: { from: 0, to: currentCode.length, insert: this.code },\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  disconnectedCallback(): void {\r\n    super.disconnectedCallback();\r\n    this._onlineUnsubscribe?.();\r\n    this._onlineManager?.stop();\r\n    this._editor?.destroy();\r\n  }\r\n\r\n  /**\r\n   * Start online mode with variable bindings\r\n   */\r\n  async startOnlineMode(bindings: VariableBinding[]): Promise<void> {\r\n    if (!this.hass?.connection) {\r\n      throw new Error(\"Home Assistant connection not available\");\r\n    }\r\n\r\n    if (!this._onlineManager) {\r\n      this._onlineManager = new OnlineStateManager(this.hass.connection);\r\n      this._onlineUnsubscribe = this._onlineManager.subscribe((state) => {\r\n        if (this._editor && state.liveValues) {\r\n          updateLiveValues(this._editor, state.liveValues);\r\n        }\r\n      });\r\n    }\r\n\r\n    await this._onlineManager.start(bindings);\r\n  }\r\n\r\n  /**\r\n   * Stop online mode\r\n   */\r\n  stopOnlineMode(): void {\r\n    this._onlineManager?.stop();\r\n  }\r\n\r\n  /**\r\n   * Pause/resume online mode\r\n   */\r\n  setOnlinePaused(paused: boolean): void {\r\n    this._onlineManager?.setPaused(paused);\r\n  }\r\n\r\n  /**\r\n   * Get current online state\r\n   */\r\n  getOnlineState(): OnlineModeState | null {\r\n    return this._onlineManager?.getState() || null;\r\n  }\r\n\r\n  private _initEditor(): void {\r\n    // Query the shadow DOM directly instead of relying on @query decorator\r\n    const container = this.shadowRoot?.querySelector(\r\n      \"#editor-container\",\r\n    ) as HTMLDivElement | null;\r\n    console.log(\"STEditor._initEditor called, container:\", container);\r\n    if (!container) {\r\n      console.error(\"STEditor: container not found!\");\r\n      return;\r\n    }\r\n\r\n    const extensions: Extension[] = [\r\n      lineNumbers(),\r\n      highlightActiveLineGutter(),\r\n      highlightSpecialChars(),\r\n      history(),\r\n      foldGutter(),\r\n      drawSelection(),\r\n      EditorState.allowMultipleSelections.of(true),\r\n      indentOnInput(),\r\n      bracketMatching(),\r\n      closeBrackets(),\r\n      autocompletion(),\r\n      highlightActiveLine(),\r\n      highlightSelectionMatches(),\r\n      keymap.of([\r\n        ...closeBracketsKeymap,\r\n        ...defaultKeymap,\r\n        ...searchKeymap,\r\n        ...historyKeymap,\r\n        ...foldKeymap,\r\n        ...completionKeymap,\r\n        indentWithTab,\r\n      ]),\r\n      structuredText(),\r\n      stTheme(),\r\n      liveValuesExtension(),\r\n      this._readOnlyCompartment.of(EditorState.readOnly.of(this.readOnly)),\r\n      EditorState.tabSize.of(4),\r\n    ];\r\n\r\n    this._editor = new EditorView({\r\n      state: EditorState.create({ doc: this.code, extensions }),\r\n      parent: container,\r\n      dispatch: (tr) => {\r\n        this._editor!.update([tr]);\r\n        if (tr.docChanged) {\r\n          this.dispatchEvent(\r\n            new CustomEvent(\"code-change\", {\r\n              detail: { code: tr.newDoc.toString() },\r\n              bubbles: true,\r\n              composed: true,\r\n            }),\r\n          );\r\n        }\r\n      },\r\n    });\r\n\r\n    // Stop keyboard events from propagating to Home Assistant's global handlers\r\n    // HA uses shortcuts like 'a' for assistant, 'm' for menu, etc.\r\n    container.addEventListener(\"keydown\", (e) => e.stopPropagation());\r\n    container.addEventListener(\"keyup\", (e) => e.stopPropagation());\r\n    container.addEventListener(\"keypress\", (e) => e.stopPropagation());\r\n\r\n    // Add drag-and-drop support for entity browser\r\n    container.addEventListener(\"dragover\", (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      if (e.dataTransfer) {\r\n        e.dataTransfer.dropEffect = \"copy\";\r\n      }\r\n    });\r\n\r\n    container.addEventListener(\"drop\", (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this._handleDrop(e);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle drop event from entity browser\r\n   */\r\n  private _handleDrop(e: DragEvent): void {\r\n    if (!this._editor || !e.dataTransfer) return;\r\n\r\n    // Try to get the binding syntax from the drag data\r\n    let bindingSyntax = e.dataTransfer.getData(\"text/plain\");\r\n    \r\n    // If no text data, try JSON data\r\n    if (!bindingSyntax) {\r\n      try {\r\n        const jsonData = e.dataTransfer.getData(\"application/json\");\r\n        if (jsonData) {\r\n          const dragData = JSON.parse(jsonData);\r\n          bindingSyntax = dragData.bindingSyntax;\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Failed to parse drag data\", err);\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (!bindingSyntax) return;\r\n\r\n    // Get cursor position from mouse coordinates\r\n    const pos = this._editor.posAtCoords({\r\n      x: e.clientX,\r\n      y: e.clientY,\r\n    });\r\n\r\n    if (pos === null) {\r\n      // Fallback to current selection or end of document\r\n      const selection = this._editor.state.selection.main;\r\n      const insertPos = selection.empty ? selection.head : selection.from;\r\n      this._editor.dispatch({\r\n        changes: { from: insertPos, insert: bindingSyntax },\r\n        selection: { anchor: insertPos + bindingSyntax.length },\r\n      });\r\n    } else {\r\n      // Insert at the drop position\r\n      this._editor.dispatch({\r\n        changes: { from: pos, insert: bindingSyntax },\r\n        selection: { anchor: pos + bindingSyntax.length },\r\n      });\r\n    }\r\n\r\n    // Focus the editor after insertion\r\n    this._editor.focus();\r\n  }\r\n\r\n  getCode(): string {\r\n    return this._editor?.state.doc.toString() ?? this.code;\r\n  }\r\n\r\n  setCode(code: string): void {\r\n    this.code = code;\r\n  }\r\n\r\n  focus(): void {\r\n    this._editor?.focus();\r\n  }\r\n\r\n  render() {\r\n    return html`<div id=\"editor-container\"></div>`;\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    \"st-editor\": STEditor;\r\n  }\r\n}\r\n","/**\r\n * Online Mode Toolbar Component\r\n */\r\n\r\nimport { LitElement, html, css } from \"lit\";\r\nimport { customElement, property, state } from \"lit/decorators.js\";\r\nimport type { OnlineModeState, OnlineStatus } from \"./types\";\r\n\r\n@customElement(\"st-online-toolbar\")\r\nexport class OnlineToolbar extends LitElement {\r\n  @property({ type: Object }) declare state: OnlineModeState;\r\n\r\n  @state() private _showSettings: boolean = false;\r\n\r\n  static styles = css`\r\n    :host {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 12px;\r\n      padding: 8px 16px;\r\n      background: var(--secondary-background-color);\r\n      border-bottom: 1px solid var(--divider-color);\r\n    }\r\n\r\n    .status {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n    }\r\n\r\n    .status-dot {\r\n      width: 8px;\r\n      height: 8px;\r\n      border-radius: 50%;\r\n    }\r\n\r\n    .status-dot--online {\r\n      background: #4ec9b0;\r\n      box-shadow: 0 0 4px #4ec9b0;\r\n    }\r\n\r\n    .status-dot--paused {\r\n      background: #dcdcaa;\r\n    }\r\n\r\n    .status-dot--connecting {\r\n      background: #569cd6;\r\n      animation: pulse 1s infinite;\r\n    }\r\n\r\n    .status-dot--disconnected {\r\n      background: #808080;\r\n    }\r\n\r\n    .status-dot--error {\r\n      background: #f44747;\r\n    }\r\n\r\n    @keyframes pulse {\r\n      0%,\r\n      100% {\r\n        opacity: 1;\r\n      }\r\n      50% {\r\n        opacity: 0.5;\r\n      }\r\n    }\r\n\r\n    .status-text {\r\n      font-size: 13px;\r\n      font-weight: 500;\r\n    }\r\n\r\n    .controls {\r\n      display: flex;\r\n      gap: 8px;\r\n    }\r\n\r\n    button {\r\n      padding: 6px 12px;\r\n      border: 1px solid var(--divider-color);\r\n      border-radius: 4px;\r\n      background: var(--card-background-color);\r\n      color: var(--primary-text-color);\r\n      cursor: pointer;\r\n      font-size: 13px;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 4px;\r\n    }\r\n\r\n    button:hover {\r\n      background: var(--secondary-background-color);\r\n    }\r\n\r\n    button:disabled {\r\n      opacity: 0.5;\r\n      cursor: not-allowed;\r\n    }\r\n\r\n    button.active {\r\n      background: var(--primary-color);\r\n      color: var(--text-primary-color);\r\n      border-color: var(--primary-color);\r\n    }\r\n\r\n    .spacer {\r\n      flex: 1;\r\n    }\r\n\r\n    .stats {\r\n      display: flex;\r\n      gap: 16px;\r\n      font-size: 12px;\r\n      color: var(--secondary-text-color);\r\n    }\r\n\r\n    .stat {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 4px;\r\n    }\r\n\r\n    .settings-panel {\r\n      position: absolute;\r\n      top: 100%;\r\n      right: 0;\r\n      background: var(--card-background-color);\r\n      border: 1px solid var(--divider-color);\r\n      border-radius: 4px;\r\n      padding: 12px;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\r\n      z-index: 100;\r\n    }\r\n\r\n    .setting {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n      margin-bottom: 8px;\r\n    }\r\n\r\n    .setting:last-child {\r\n      margin-bottom: 0;\r\n    }\r\n\r\n    .setting label {\r\n      font-size: 13px;\r\n    }\r\n  `;\r\n\r\n  private get statusText(): string {\r\n    const texts: Record<OnlineStatus, string> = {\r\n      disconnected: \"Offline\",\r\n      connecting: \"Connecting...\",\r\n      online: \"Online\",\r\n      paused: \"Paused\",\r\n      error: \"Error\",\r\n    };\r\n    return texts[this.state?.status || \"disconnected\"];\r\n  }\r\n\r\n  private get isPaused(): boolean {\r\n    return this.state?.status === \"paused\";\r\n  }\r\n\r\n  private get canConnect(): boolean {\r\n    return [\"disconnected\", \"error\"].includes(this.state?.status || \"disconnected\");\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <div class=\"status\">\r\n        <span\r\n          class=\"status-dot status-dot--${this.state?.status || \"disconnected\"}\"\r\n        ></span>\r\n        <span class=\"status-text\">${this.statusText}</span>\r\n      </div>\r\n\r\n      <div class=\"controls\">\r\n        ${this.canConnect\r\n          ? html` <button @click=${this._handleConnect}>笆ｶ Connect</button> `\r\n          : html`\r\n              <button\r\n                @click=${this._handleTogglePause}\r\n                class=\"${this.isPaused ? \"active\" : \"\"}\"\r\n              >\r\n                ${this.isPaused ? \"笆ｶ Resume\" : \"竢ｸ Pause\"}\r\n              </button>\r\n              <button @click=${this._handleDisconnect}>竢ｹ Stop</button>\r\n            `}\r\n      </div>\r\n\r\n      <div class=\"spacer\"></div>\r\n\r\n      <div class=\"stats\">\r\n        <div class=\"stat\">沒 ${this.state?.liveValues?.size || 0} Variables</div>\r\n        <div class=\"stat\">笞｡ ${this.state?.updateRate || 100}ms</div>\r\n      </div>\r\n\r\n      <div style=\"position: relative;\">\r\n        <button @click=${() => (this._showSettings = !this._showSettings)}>\r\n          笞呻ｸ十r\n        </button>\r\n        ${this._showSettings ? this._renderSettings() : \"\"}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private _renderSettings() {\r\n    return html`\r\n      <div class=\"settings-panel\">\r\n        <div class=\"setting\">\r\n          <input\r\n            type=\"checkbox\"\r\n            id=\"highlight\"\r\n            .checked=${this.state?.highlightChanges}\r\n            @change=${this._handleHighlightChange}\r\n          />\r\n          <label for=\"highlight\">Highlight changes</label>\r\n        </div>\r\n        <div class=\"setting\">\r\n          <input\r\n            type=\"checkbox\"\r\n            id=\"conditions\"\r\n            .checked=${this.state?.showConditions}\r\n            @change=${this._handleConditionsChange}\r\n          />\r\n          <label for=\"conditions\">Show conditions</label>\r\n        </div>\r\n        <div class=\"setting\">\r\n          <label>Update rate:</label>\r\n          <select @change=${this._handleRateChange}>\r\n            <option value=\"50\" ?selected=${this.state?.updateRate === 50}>\r\n              50ms\r\n            </option>\r\n            <option value=\"100\" ?selected=${this.state?.updateRate === 100}>\r\n              100ms\r\n            </option>\r\n            <option value=\"250\" ?selected=${this.state?.updateRate === 250}>\r\n              250ms\r\n            </option>\r\n            <option value=\"500\" ?selected=${this.state?.updateRate === 500}>\r\n              500ms\r\n            </option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private _handleConnect(): void {\r\n    this.dispatchEvent(\r\n      new CustomEvent(\"connect\", { bubbles: true, composed: true }),\r\n    );\r\n  }\r\n\r\n  private _handleDisconnect(): void {\r\n    this.dispatchEvent(\r\n      new CustomEvent(\"disconnect\", { bubbles: true, composed: true }),\r\n    );\r\n  }\r\n\r\n  private _handleTogglePause(): void {\r\n    this.dispatchEvent(\r\n      new CustomEvent(\"toggle-pause\", { bubbles: true, composed: true }),\r\n    );\r\n  }\r\n\r\n  private _handleHighlightChange(e: Event): void {\r\n    const checked = (e.target as HTMLInputElement).checked;\r\n    this.dispatchEvent(\r\n      new CustomEvent(\"setting-change\", {\r\n        detail: { setting: \"highlightChanges\", value: checked },\r\n        bubbles: true,\r\n        composed: true,\r\n      }),\r\n    );\r\n  }\r\n\r\n  private _handleConditionsChange(e: Event): void {\r\n    const checked = (e.target as HTMLInputElement).checked;\r\n    this.dispatchEvent(\r\n      new CustomEvent(\"setting-change\", {\r\n        detail: { setting: \"showConditions\", value: checked },\r\n        bubbles: true,\r\n        composed: true,\r\n      }),\r\n    );\r\n  }\r\n\r\n  private _handleRateChange(e: Event): void {\r\n    const value = Number.parseInt((e.target as HTMLSelectElement).value, 10);\r\n    this.dispatchEvent(\r\n      new CustomEvent(\"setting-change\", {\r\n        detail: { setting: \"updateRate\", value },\r\n        bubbles: true,\r\n        composed: true,\r\n      }),\r\n    );\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    \"st-online-toolbar\": OnlineToolbar;\r\n  }\r\n}\r\n","/**\r\n * Chevrotain Token Definitions for Structured Text\r\n */\r\n\r\nimport { createToken, Lexer, TokenType } from \"chevrotain\";\r\n\r\n// Helper to create keyword tokens with word boundaries\r\nconst keyword = (name: string, text: string) =>\r\n  createToken({ name, pattern: new RegExp(`\\\\b${text}\\\\b`, \"i\") });\r\n\r\n// ============================================================================\r\n// Whitespace & Comments (skipped)\r\n// ============================================================================\r\n\r\nexport const WhiteSpace = createToken({\r\n  name: \"WhiteSpace\",\r\n  pattern: /\\s+/,\r\n  group: Lexer.SKIPPED,\r\n});\r\n\r\nexport const LineComment = createToken({\r\n  name: \"LineComment\",\r\n  pattern: /\\/\\/.*/,\r\n  group: Lexer.SKIPPED,\r\n});\r\n\r\nexport const BlockComment = createToken({\r\n  name: \"BlockComment\",\r\n  pattern: /\\(\\*[\\s\\S]*?\\*\\)/,\r\n  group: Lexer.SKIPPED,\r\n});\r\n\r\n// ============================================================================\r\n// Pragmas\r\n// ============================================================================\r\n\r\nexport const Pragma = createToken({\r\n  name: \"Pragma\",\r\n  pattern: /\\{[^}]+\\}/,\r\n});\r\n\r\n// ============================================================================\r\n// Keywords (order matters - longer first)\r\n// ============================================================================\r\n\r\nexport const EndProgram = createToken({\r\n  name: \"EndProgram\",\r\n  pattern: /END_PROGRAM/i,\r\n  longer_alt: undefined,\r\n});\r\nexport const EndFunction = createToken({\r\n  name: \"EndFunction\",\r\n  pattern: /END_FUNCTION/i,\r\n});\r\nexport const EndFunctionBlock = createToken({\r\n  name: \"EndFunctionBlock\",\r\n  pattern: /END_FUNCTION_BLOCK/i,\r\n});\r\nexport const FunctionBlock = createToken({\r\n  name: \"FunctionBlock\",\r\n  pattern: /FUNCTION_BLOCK/i,\r\n});\r\nexport const EndVar = createToken({ name: \"EndVar\", pattern: /END_VAR/i });\r\nexport const VarInput = createToken({\r\n  name: \"VarInput\",\r\n  pattern: /VAR_INPUT/i,\r\n});\r\nexport const VarOutput = createToken({\r\n  name: \"VarOutput\",\r\n  pattern: /VAR_OUTPUT/i,\r\n});\r\nexport const VarInOut = createToken({\r\n  name: \"VarInOut\",\r\n  pattern: /VAR_IN_OUT/i,\r\n});\r\nexport const VarGlobal = createToken({\r\n  name: \"VarGlobal\",\r\n  pattern: /VAR_GLOBAL/i,\r\n});\r\nexport const EndIf = createToken({ name: \"EndIf\", pattern: /END_IF/i });\r\nexport const EndCase = createToken({ name: \"EndCase\", pattern: /END_CASE/i });\r\nexport const EndFor = createToken({ name: \"EndFor\", pattern: /END_FOR/i });\r\nexport const EndWhile = createToken({\r\n  name: \"EndWhile\",\r\n  pattern: /END_WHILE/i,\r\n});\r\nexport const EndRepeat = createToken({\r\n  name: \"EndRepeat\",\r\n  pattern: /END_REPEAT/i,\r\n});\r\n\r\nexport const Program = keyword(\"Program\", \"PROGRAM\");\r\nexport const Function = keyword(\"Function\", \"FUNCTION\");\r\nexport const Var = keyword(\"Var\", \"VAR\");\r\nexport const Constant = keyword(\"Constant\", \"CONSTANT\");\r\n\r\nexport const If = keyword(\"If\", \"IF\");\r\nexport const Then = keyword(\"Then\", \"THEN\");\r\nexport const Elsif = keyword(\"Elsif\", \"ELSIF\");\r\nexport const Else = keyword(\"Else\", \"ELSE\");\r\n\r\nexport const Case = keyword(\"Case\", \"CASE\");\r\nexport const Of = keyword(\"Of\", \"OF\");\r\n\r\nexport const For = keyword(\"For\", \"FOR\");\r\nexport const To = keyword(\"To\", \"TO\");\r\nexport const By = keyword(\"By\", \"BY\");\r\nexport const Do = keyword(\"Do\", \"DO\");\r\n\r\nexport const While = keyword(\"While\", \"WHILE\");\r\nexport const Repeat = keyword(\"Repeat\", \"REPEAT\");\r\nexport const Until = keyword(\"Until\", \"UNTIL\");\r\n\r\nexport const Return = keyword(\"Return\", \"RETURN\");\r\nexport const Exit = keyword(\"Exit\", \"EXIT\");\r\nexport const Continue = keyword(\"Continue\", \"CONTINUE\");\r\n\r\nexport const At = keyword(\"At\", \"AT\");\r\n\r\n// Logical operators (before Identifier!)\r\nexport const And = keyword(\"And\", \"AND\");\r\nexport const Or = keyword(\"Or\", \"OR\");\r\nexport const Xor = keyword(\"Xor\", \"XOR\");\r\nexport const Not = keyword(\"Not\", \"NOT\");\r\nexport const Mod = keyword(\"Mod\", \"MOD\");\r\n\r\n// Boolean literals\r\nexport const True = keyword(\"True\", \"TRUE\");\r\nexport const False = keyword(\"False\", \"FALSE\");\r\n\r\n// ============================================================================\r\n// Data Types\r\n// ============================================================================\r\n\r\nexport const TypeBool = keyword(\"TypeBool\", \"BOOL\");\r\nexport const TypeInt = createToken({\r\n  name: \"TypeInt\",\r\n  pattern: /\\b(DINT|LINT|SINT|USINT|UINT|UDINT|ULINT|INT)\\b/i,\r\n});\r\nexport const TypeReal = createToken({\r\n  name: \"TypeReal\",\r\n  pattern: /\\b(LREAL|REAL)\\b/i,\r\n});\r\nexport const TypeString = createToken({\r\n  name: \"TypeString\",\r\n  pattern: /\\b(WSTRING|STRING)\\b/i,\r\n});\r\nexport const TypeTime = createToken({\r\n  name: \"TypeTime\",\r\n  pattern: /\\b(TIME_OF_DAY|DATE_AND_TIME|TIME|DATE|TOD|DT)\\b/i,\r\n});\r\nexport const TypeByte = createToken({\r\n  name: \"TypeByte\",\r\n  pattern: /\\b(LWORD|DWORD|WORD|BYTE)\\b/i,\r\n});\r\n\r\n// ============================================================================\r\n// Literals\r\n// ============================================================================\r\n\r\nexport const TimeLiteral = createToken({\r\n  name: \"TimeLiteral\",\r\n  pattern: /T(IME)?#[\\d_]+(\\.[\\d_]+)?([a-z]+)?/i,\r\n});\r\n\r\nexport const HexLiteral = createToken({\r\n  name: \"HexLiteral\",\r\n  pattern: /16#[\\da-fA-F_]+/,\r\n});\r\n\r\nexport const BinaryLiteral = createToken({\r\n  name: \"BinaryLiteral\",\r\n  pattern: /2#[01_]+/,\r\n});\r\n\r\nexport const OctalLiteral = createToken({\r\n  name: \"OctalLiteral\",\r\n  pattern: /8#[0-7_]+/,\r\n});\r\n\r\nexport const RealLiteral = createToken({\r\n  name: \"RealLiteral\",\r\n  pattern: /\\d+\\.\\d+([eE][+-]?\\d+)?/,\r\n});\r\n\r\nexport const IntegerLiteral = createToken({\r\n  name: \"IntegerLiteral\",\r\n  pattern: /\\d+/,\r\n});\r\n\r\nexport const StringLiteral = createToken({\r\n  name: \"StringLiteral\",\r\n  pattern: /'([^']|'')*'/,\r\n});\r\n\r\n// ============================================================================\r\n// I/O Addresses\r\n// ============================================================================\r\n\r\nexport const IoAddress = createToken({\r\n  name: \"IoAddress\",\r\n  pattern: /%[IQM][XBWDLxbwdl]?(?:[\\d.]+|\\*)/i,\r\n});\r\n\r\n// ============================================================================\r\n// Operators & Punctuation\r\n// ============================================================================\r\n\r\nexport const Assign = createToken({ name: \"Assign\", pattern: /:=/ });\r\nexport const Output = createToken({ name: \"Output\", pattern: /=>/ });\r\nexport const LessEqual = createToken({ name: \"LessEqual\", pattern: /<=/ });\r\nexport const GreaterEqual = createToken({\r\n  name: \"GreaterEqual\",\r\n  pattern: />=/,\r\n});\r\nexport const NotEqual = createToken({ name: \"NotEqual\", pattern: /<>/ });\r\nexport const Less = createToken({ name: \"Less\", pattern: /</ });\r\nexport const Greater = createToken({ name: \"Greater\", pattern: />/ });\r\nexport const Equal = createToken({ name: \"Equal\", pattern: /=/ });\r\n\r\nexport const Plus = createToken({ name: \"Plus\", pattern: /\\+/ });\r\nexport const Minus = createToken({ name: \"Minus\", pattern: /-/ });\r\nexport const Star = createToken({ name: \"Star\", pattern: /\\*/ });\r\nexport const Slash = createToken({ name: \"Slash\", pattern: /\\// });\r\n\r\nexport const LParen = createToken({ name: \"LParen\", pattern: /\\(/ });\r\nexport const RParen = createToken({ name: \"RParen\", pattern: /\\)/ });\r\nexport const LBracket = createToken({ name: \"LBracket\", pattern: /\\[/ });\r\nexport const RBracket = createToken({ name: \"RBracket\", pattern: /\\]/ });\r\n\r\nexport const Colon = createToken({ name: \"Colon\", pattern: /:/ });\r\nexport const Semicolon = createToken({ name: \"Semicolon\", pattern: /;/ });\r\nexport const Comma = createToken({ name: \"Comma\", pattern: /,/ });\r\nexport const Dot = createToken({ name: \"Dot\", pattern: /\\./ });\r\nexport const Range = createToken({ name: \"Range\", pattern: /\\.\\./ });\r\n\r\n// ============================================================================\r\n// Identifier (MUST be last!)\r\n// ============================================================================\r\n\r\nexport const Identifier = createToken({\r\n  name: \"Identifier\",\r\n  pattern: /[a-zA-Z_][a-zA-Z0-9_]*/,\r\n});\r\n\r\n// ============================================================================\r\n// Token List (ORDER MATTERS!)\r\n// ============================================================================\r\n\r\nexport const allTokens: TokenType[] = [\r\n  // Skipped\r\n  WhiteSpace,\r\n  LineComment,\r\n  BlockComment,\r\n\r\n  // Pragmas\r\n  Pragma,\r\n\r\n  // Multi-word keywords first\r\n  EndFunctionBlock,\r\n  FunctionBlock,\r\n  EndFunction,\r\n  EndProgram,\r\n  VarInput,\r\n  VarOutput,\r\n  VarInOut,\r\n  VarGlobal,\r\n  EndVar,\r\n  EndIf,\r\n  EndCase,\r\n  EndFor,\r\n  EndWhile,\r\n  EndRepeat,\r\n\r\n  // Keywords\r\n  Program,\r\n  Function,\r\n  Var,\r\n  Constant,\r\n  If,\r\n  Then,\r\n  Elsif,\r\n  Else,\r\n  Case,\r\n  Of,\r\n  For,\r\n  To,\r\n  By,\r\n  Do,\r\n  While,\r\n  Repeat,\r\n  Until,\r\n  Return,\r\n  Exit,\r\n  Continue,\r\n  At,\r\n\r\n  // Logical\r\n  And,\r\n  Or,\r\n  Xor,\r\n  Not,\r\n  Mod,\r\n  True,\r\n  False,\r\n\r\n  // Types\r\n  TypeBool,\r\n  TypeInt,\r\n  TypeReal,\r\n  TypeString,\r\n  TypeTime,\r\n  TypeByte,\r\n\r\n  // Literals (order: specific before general)\r\n  TimeLiteral,\r\n  HexLiteral,\r\n  BinaryLiteral,\r\n  OctalLiteral,\r\n  RealLiteral,\r\n  IntegerLiteral,\r\n  StringLiteral,\r\n\r\n  // I/O\r\n  IoAddress,\r\n\r\n  // Multi-char operators\r\n  Assign,\r\n  Output,\r\n  Range,\r\n  LessEqual,\r\n  GreaterEqual,\r\n  NotEqual,\r\n\r\n  // Single-char operators\r\n  Less,\r\n  Greater,\r\n  Equal,\r\n  Plus,\r\n  Minus,\r\n  Star,\r\n  Slash,\r\n  LParen,\r\n  RParen,\r\n  LBracket,\r\n  RBracket,\r\n  Colon,\r\n  Semicolon,\r\n  Comma,\r\n  Dot,\r\n\r\n  // Identifier last\r\n  Identifier,\r\n];\r\n","/**\r\n * Chevrotain Lexer for Structured Text\r\n */\r\n\r\nimport { Lexer } from 'chevrotain';\r\nimport { allTokens } from './tokens';\r\n\r\nexport const STLexer = new Lexer(allTokens, {\r\n  ensureOptimizations: true,\r\n  positionTracking: 'full'  // For error reporting\r\n});\r\n\r\nexport interface LexResult {\r\n  tokens: ReturnType<typeof STLexer.tokenize>['tokens'];\r\n  errors: ReturnType<typeof STLexer.tokenize>['errors'];\r\n}\r\n\r\nexport function tokenize(code: string): LexResult {\r\n  const result = STLexer.tokenize(code);\r\n  return {\r\n    tokens: result.tokens,\r\n    errors: result.errors\r\n  };\r\n}\r\n","import { CstParser } from \"chevrotain\";\r\nimport {\r\n  allTokens,\r\n  // Keywords\r\n  Program,\r\n  EndProgram,\r\n  Var,\r\n  EndVar,\r\n  VarInput,\r\n  VarOutput,\r\n  VarInOut,\r\n  VarGlobal,\r\n  If,\r\n  Then,\r\n  Elsif,\r\n  Else,\r\n  EndIf,\r\n  Case,\r\n  Of,\r\n  EndCase,\r\n  For,\r\n  To,\r\n  By,\r\n  Do,\r\n  EndFor,\r\n  While,\r\n  EndWhile,\r\n  Repeat,\r\n  Until,\r\n  EndRepeat,\r\n  Return,\r\n  Exit,\r\n  At,\r\n  // Types\r\n  TypeBool,\r\n  TypeInt,\r\n  TypeReal,\r\n  TypeString,\r\n  TypeTime,\r\n  // Logical operators\r\n  Or,\r\n  And,\r\n  Not,\r\n  Mod,\r\n  // Literals\r\n  True,\r\n  False,\r\n  IntegerLiteral,\r\n  RealLiteral,\r\n  StringLiteral,\r\n  TimeLiteral,\r\n  // Operators\r\n  Assign,\r\n  Equal,\r\n  NotEqual,\r\n  Less,\r\n  LessEqual,\r\n  Greater,\r\n  GreaterEqual,\r\n  Plus,\r\n  Minus,\r\n  Star,\r\n  Slash,\r\n  // Identifiers and I/O\r\n  Identifier,\r\n  IoAddress,\r\n  Pragma,\r\n  // Punctuation\r\n  LParen,\r\n  RParen,\r\n  Comma,\r\n  Semicolon,\r\n  Colon,\r\n  Dot,\r\n  Range,\r\n} from \"./tokens\";\r\n\r\nexport class STParser extends CstParser {\r\n  constructor() {\r\n    super(allTokens, {\r\n      recoveryEnabled: true,\r\n      nodeLocationTracking: \"full\",\r\n    });\r\n    this.performSelfAnalysis();\r\n  }\r\n\r\n  // Program structure\r\n  public program = this.RULE(\"program\", () => {\r\n    this.MANY(() => this.SUBRULE(this.pragma));\r\n    this.CONSUME(Program);\r\n    this.CONSUME(Identifier, { LABEL: \"programName\" });\r\n    this.MANY1(() => this.SUBRULE(this.variableBlock));\r\n    this.MANY2(() => this.SUBRULE(this.statement));\r\n    this.CONSUME(EndProgram);\r\n  });\r\n\r\n  // Variable declarations\r\n  private variableBlock = this.RULE(\"variableBlock\", () => {\r\n    this.OR([\r\n      { ALT: () => this.CONSUME(Var) },\r\n      { ALT: () => this.CONSUME(VarInput) },\r\n      { ALT: () => this.CONSUME(VarOutput) },\r\n      { ALT: () => this.CONSUME(VarInOut) },\r\n      { ALT: () => this.CONSUME(VarGlobal) },\r\n    ]);\r\n    this.MANY(() => this.SUBRULE(this.variableDeclaration));\r\n    this.CONSUME(EndVar);\r\n  });\r\n\r\n  private variableDeclaration = this.RULE(\"variableDeclaration\", () => {\r\n    this.MANY(() => this.SUBRULE(this.pragma));\r\n    this.CONSUME(Identifier, { LABEL: \"varName\" });\r\n\r\n    // Support both: \"name AT %addr : type\" and \"name : type AT %addr\"\r\n    this.OPTION(() => {\r\n      this.CONSUME(At);\r\n      this.CONSUME(IoAddress);\r\n    });\r\n\r\n    this.OPTION1(() => {\r\n      this.CONSUME(Colon);\r\n      this.SUBRULE(this.typeSpec);\r\n    });\r\n\r\n    this.OPTION2(() => {\r\n      this.CONSUME(Assign);\r\n      this.SUBRULE(this.expression);\r\n    });\r\n\r\n    this.OPTION3(() => {\r\n      this.CONSUME1(At);\r\n      this.CONSUME1(IoAddress);\r\n    });\r\n\r\n    this.CONSUME(Semicolon);\r\n  });\r\n\r\n  private pragma = this.RULE(\"pragma\", () => {\r\n    this.CONSUME(Pragma);\r\n  });\r\n\r\n  private typeSpec = this.RULE(\"typeSpec\", () => {\r\n    this.OR([\r\n      { ALT: () => this.CONSUME(TypeBool) },\r\n      { ALT: () => this.CONSUME(TypeInt) },\r\n      { ALT: () => this.CONSUME(TypeReal) },\r\n      { ALT: () => this.CONSUME(TypeString) },\r\n      { ALT: () => this.CONSUME(TypeTime) },\r\n      { ALT: () => this.CONSUME(Identifier) }, // Custom type\r\n    ]);\r\n  });\r\n\r\n  // Statements\r\n  private statement = this.RULE(\"statement\", () => {\r\n    this.OR([\r\n      { ALT: () => this.SUBRULE(this.assignmentStatement) },\r\n      { ALT: () => this.SUBRULE(this.ifStatement) },\r\n      { ALT: () => this.SUBRULE(this.caseStatement) },\r\n      { ALT: () => this.SUBRULE(this.forStatement) },\r\n      { ALT: () => this.SUBRULE(this.whileStatement) },\r\n      { ALT: () => this.SUBRULE(this.repeatStatement) },\r\n      { ALT: () => this.SUBRULE(this.returnStatement) },\r\n      { ALT: () => this.SUBRULE(this.exitStatement) },\r\n      { ALT: () => this.SUBRULE(this.functionCallStatement) },\r\n    ]);\r\n  });\r\n\r\n  private assignmentStatement = this.RULE(\"assignmentStatement\", () => {\r\n    this.SUBRULE(this.variableReference);\r\n    this.CONSUME(Assign);\r\n    this.SUBRULE(this.expression);\r\n    this.CONSUME(Semicolon);\r\n  });\r\n\r\n  private ifStatement = this.RULE(\"ifStatement\", () => {\r\n    this.CONSUME(If);\r\n    this.SUBRULE(this.expression, { LABEL: \"condition\" });\r\n    this.CONSUME(Then);\r\n    this.MANY(() => this.SUBRULE(this.statement, { LABEL: \"thenStatements\" }));\r\n    this.MANY1(() => {\r\n      this.CONSUME(Elsif);\r\n      this.SUBRULE1(this.expression, { LABEL: \"elsifCondition\" });\r\n      this.CONSUME1(Then);\r\n      this.MANY2(() =>\r\n        this.SUBRULE1(this.statement, { LABEL: \"elsifStatements\" }),\r\n      );\r\n    });\r\n    this.OPTION(() => {\r\n      this.CONSUME(Else);\r\n      this.MANY3(() =>\r\n        this.SUBRULE2(this.statement, { LABEL: \"elseStatements\" }),\r\n      );\r\n    });\r\n    this.CONSUME(EndIf);\r\n  });\r\n\r\n  private caseStatement = this.RULE(\"caseStatement\", () => {\r\n    this.CONSUME(Case);\r\n    this.SUBRULE(this.expression, { LABEL: \"selector\" });\r\n    this.CONSUME(Of);\r\n    this.MANY(() => this.SUBRULE(this.caseClause));\r\n    this.OPTION(() => {\r\n      this.CONSUME(Else);\r\n      this.MANY1(() => this.SUBRULE(this.statement));\r\n    });\r\n    this.CONSUME(EndCase);\r\n  });\r\n\r\n  private caseClause = this.RULE(\"caseClause\", () => {\r\n    this.SUBRULE(this.caseLabelList);\r\n    this.CONSUME(Colon);\r\n    this.MANY(() => this.SUBRULE(this.statement));\r\n  });\r\n\r\n  private caseLabelList = this.RULE(\"caseLabelList\", () => {\r\n    this.SUBRULE(this.caseLabel);\r\n    this.MANY(() => {\r\n      this.CONSUME(Comma);\r\n      this.SUBRULE1(this.caseLabel);\r\n    });\r\n  });\r\n\r\n  private caseLabel = this.RULE(\"caseLabel\", () => {\r\n    this.SUBRULE(this.expression);\r\n    this.OPTION(() => {\r\n      this.CONSUME(Range);\r\n      this.SUBRULE1(this.expression);\r\n    });\r\n  });\r\n\r\n  private forStatement = this.RULE(\"forStatement\", () => {\r\n    this.CONSUME(For);\r\n    this.CONSUME(Identifier, { LABEL: \"controlVar\" });\r\n    this.CONSUME(Assign);\r\n    this.SUBRULE(this.expression, { LABEL: \"start\" });\r\n    this.CONSUME(To);\r\n    this.SUBRULE1(this.expression, { LABEL: \"end\" });\r\n    this.OPTION(() => {\r\n      this.CONSUME(By);\r\n      this.SUBRULE2(this.expression, { LABEL: \"step\" });\r\n    });\r\n    this.CONSUME(Do);\r\n    this.MANY(() => this.SUBRULE(this.statement));\r\n    this.CONSUME(EndFor);\r\n  });\r\n\r\n  private whileStatement = this.RULE(\"whileStatement\", () => {\r\n    this.CONSUME(While);\r\n    this.SUBRULE(this.expression);\r\n    this.CONSUME(Do);\r\n    this.MANY(() => this.SUBRULE(this.statement));\r\n    this.CONSUME(EndWhile);\r\n  });\r\n\r\n  private repeatStatement = this.RULE(\"repeatStatement\", () => {\r\n    this.CONSUME(Repeat);\r\n    this.MANY(() => this.SUBRULE(this.statement));\r\n    this.CONSUME(Until);\r\n    this.SUBRULE(this.expression);\r\n    this.CONSUME(EndRepeat);\r\n  });\r\n\r\n  private returnStatement = this.RULE(\"returnStatement\", () => {\r\n    this.CONSUME(Return);\r\n    this.CONSUME(Semicolon);\r\n  });\r\n\r\n  private exitStatement = this.RULE(\"exitStatement\", () => {\r\n    this.CONSUME(Exit);\r\n    this.CONSUME(Semicolon);\r\n  });\r\n\r\n  private functionCallStatement = this.RULE(\"functionCallStatement\", () => {\r\n    this.SUBRULE(this.functionCall);\r\n    this.CONSUME(Semicolon);\r\n  });\r\n\r\n  // Expressions with operator precedence\r\n  private expression = this.RULE(\"expression\", () => {\r\n    this.SUBRULE(this.orExpression);\r\n  });\r\n\r\n  private orExpression = this.RULE(\"orExpression\", () => {\r\n    this.SUBRULE(this.andExpression, { LABEL: \"lhs\" });\r\n    this.MANY(() => {\r\n      this.CONSUME(Or);\r\n      this.SUBRULE1(this.andExpression, { LABEL: \"rhs\" });\r\n    });\r\n  });\r\n\r\n  private andExpression = this.RULE(\"andExpression\", () => {\r\n    this.SUBRULE(this.comparisonExpression, { LABEL: \"lhs\" });\r\n    this.MANY(() => {\r\n      this.CONSUME(And);\r\n      this.SUBRULE1(this.comparisonExpression, { LABEL: \"rhs\" });\r\n    });\r\n  });\r\n\r\n  private comparisonExpression = this.RULE(\"comparisonExpression\", () => {\r\n    this.SUBRULE(this.additiveExpression, { LABEL: \"lhs\" });\r\n    this.OPTION(() => {\r\n      this.OR([\r\n        { ALT: () => this.CONSUME(Equal) },\r\n        { ALT: () => this.CONSUME(NotEqual) },\r\n        { ALT: () => this.CONSUME(Less) },\r\n        { ALT: () => this.CONSUME(LessEqual) },\r\n        { ALT: () => this.CONSUME(Greater) },\r\n        { ALT: () => this.CONSUME(GreaterEqual) },\r\n      ]);\r\n      this.SUBRULE1(this.additiveExpression, { LABEL: \"rhs\" });\r\n    });\r\n  });\r\n\r\n  private additiveExpression = this.RULE(\"additiveExpression\", () => {\r\n    this.SUBRULE(this.multiplicativeExpression, { LABEL: \"lhs\" });\r\n    this.MANY(() => {\r\n      this.OR([\r\n        { ALT: () => this.CONSUME(Plus) },\r\n        { ALT: () => this.CONSUME(Minus) },\r\n      ]);\r\n      this.SUBRULE1(this.multiplicativeExpression, { LABEL: \"rhs\" });\r\n    });\r\n  });\r\n\r\n  private multiplicativeExpression = this.RULE(\r\n    \"multiplicativeExpression\",\r\n    () => {\r\n      this.SUBRULE(this.unaryExpression, { LABEL: \"lhs\" });\r\n      this.MANY(() => {\r\n        this.OR([\r\n          { ALT: () => this.CONSUME(Star) },\r\n          { ALT: () => this.CONSUME(Slash) },\r\n          { ALT: () => this.CONSUME(Mod) },\r\n        ]);\r\n        this.SUBRULE1(this.unaryExpression, { LABEL: \"rhs\" });\r\n      });\r\n    },\r\n  );\r\n\r\n  private unaryExpression = this.RULE(\"unaryExpression\", () => {\r\n    this.OR([\r\n      {\r\n        ALT: () => {\r\n          this.OR1([\r\n            { ALT: () => this.CONSUME(Not) },\r\n            { ALT: () => this.CONSUME(Minus) },\r\n          ]);\r\n          this.SUBRULE(this.unaryExpression);\r\n        },\r\n      },\r\n      { ALT: () => this.SUBRULE(this.primaryExpression) },\r\n    ]);\r\n  });\r\n\r\n  private primaryExpression = this.RULE(\"primaryExpression\", () => {\r\n    this.OR([\r\n      { ALT: () => this.SUBRULE(this.literal) },\r\n      { ALT: () => this.SUBRULE(this.identifierOrCall) },\r\n      {\r\n        ALT: () => {\r\n          this.CONSUME(LParen);\r\n          this.SUBRULE(this.expression);\r\n          this.CONSUME(RParen);\r\n        },\r\n      },\r\n    ]);\r\n  });\r\n\r\n  private identifierOrCall = this.RULE(\"identifierOrCall\", () => {\r\n    this.CONSUME(Identifier);\r\n    this.MANY(() => {\r\n      this.CONSUME(Dot);\r\n      this.CONSUME1(Identifier);\r\n    });\r\n    this.OPTION(() => {\r\n      this.CONSUME(LParen);\r\n      this.OPTION1(() => {\r\n        this.SUBRULE(this.argumentList);\r\n      });\r\n      this.CONSUME(RParen);\r\n    });\r\n  });\r\n\r\n  private literal = this.RULE(\"literal\", () => {\r\n    this.OR([\r\n      { ALT: () => this.CONSUME(True) },\r\n      { ALT: () => this.CONSUME(False) },\r\n      { ALT: () => this.CONSUME(IntegerLiteral) },\r\n      { ALT: () => this.CONSUME(RealLiteral) },\r\n      { ALT: () => this.CONSUME(StringLiteral) },\r\n      { ALT: () => this.CONSUME(TimeLiteral) },\r\n    ]);\r\n  });\r\n\r\n  private variableReference = this.RULE(\"variableReference\", () => {\r\n    this.CONSUME(Identifier);\r\n    this.MANY(() => {\r\n      this.CONSUME(Dot);\r\n      this.CONSUME1(Identifier);\r\n    });\r\n  });\r\n\r\n  private functionCall = this.RULE(\"functionCall\", () => {\r\n    this.CONSUME(Identifier);\r\n    this.CONSUME(LParen);\r\n    this.OPTION(() => {\r\n      this.SUBRULE(this.argumentList);\r\n    });\r\n    this.CONSUME(RParen);\r\n  });\r\n\r\n  private argumentList = this.RULE(\"argumentList\", () => {\r\n    this.SUBRULE(this.argument);\r\n    this.MANY(() => {\r\n      this.CONSUME(Comma);\r\n      this.SUBRULE1(this.argument);\r\n    });\r\n  });\r\n\r\n  /**\r\n   * Function argument\r\n   * Supports both positional and named arguments:\r\n   *   - foo(1, 2)\r\n   *   - foo(IN := TRUE, PT := T#5s)\r\n   */\r\n  private argument = this.RULE(\"argument\", () => {\r\n    this.OPTION(() => {\r\n      this.CONSUME(Identifier, { LABEL: \"argName\" });\r\n      this.CONSUME(Assign);\r\n    });\r\n    this.SUBRULE(this.expression, { LABEL: \"argValue\" });\r\n  });\r\n}\r\n\r\n// Export singleton instance\r\nexport const parserInstance = new STParser();\r\n","/**\r\n * CST to AST Visitor\r\n * Transforms Chevrotain's Concrete Syntax Tree to our custom AST\r\n */\r\n\r\nimport { CstNode, IToken } from \"chevrotain\";\r\nimport { parserInstance } from \"./parser\";\r\nimport type {\r\n  ProgramNode,\r\n  VariableDeclaration,\r\n  Statement,\r\n  Expression,\r\n  PragmaNode,\r\n  IfStatement,\r\n  CaseStatement,\r\n  ForStatement,\r\n  WhileStatement,\r\n  RepeatStatement,\r\n  AssignmentStatement,\r\n  ReturnStatement,\r\n  ExitStatement,\r\n  FunctionCallStatement,\r\n  Literal,\r\n  VariableRef,\r\n  FunctionCall,\r\n  DataType,\r\n  EntityBinding,\r\n  VarSection,\r\n  SourceLocation,\r\n  FunctionArgument,\r\n} from \"./ast\";\r\n\r\nconst BaseVisitor = parserInstance.getBaseCstVisitorConstructor();\r\n\r\n// Define a type for the context to avoid 'any'\r\ntype CstContext = Record<string, CstNode[] | IToken[]>;\r\n\r\nexport class STVisitor extends BaseVisitor {\r\n  constructor() {\r\n    super();\r\n    this.validateVisitor();\r\n  }\r\n\r\n  // Program\r\n  program(ctx: {\r\n    pragma?: CstNode[];\r\n    programName: IToken[];\r\n    variableBlock?: CstNode[];\r\n    statement?: CstNode[];\r\n  }): ProgramNode {\r\n    const pragmas: PragmaNode[] = ctx.pragma\r\n      ? ctx.pragma.map((p) => this.visit(p))\r\n      : [];\r\n    const programName = ctx.programName[0].image;\r\n    const variables: VariableDeclaration[] = ctx.variableBlock\r\n      ? ctx.variableBlock.flatMap((vb) => this.visit(vb))\r\n      : [];\r\n    const body: Statement[] = ctx.statement\r\n      ? ctx.statement.map((s) => this.visit(s))\r\n      : [];\r\n\r\n    return {\r\n      type: \"Program\",\r\n      name: programName,\r\n      pragmas,\r\n      variables,\r\n      body,\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  // Variable declarations\r\n  variableBlock(ctx: {\r\n    VarInput?: IToken[];\r\n    VarOutput?: IToken[];\r\n    VarInOut?: IToken[];\r\n    VarGlobal?: IToken[];\r\n    variableDeclaration?: CstNode[];\r\n  }): VariableDeclaration[] {\r\n    let section: VarSection = \"VAR\";\r\n\r\n    if (ctx.VarInput) section = \"VAR_INPUT\";\r\n    else if (ctx.VarOutput) section = \"VAR_OUTPUT\";\r\n    else if (ctx.VarInOut) section = \"VAR_IN_OUT\";\r\n    else if (ctx.VarGlobal) section = \"VAR_GLOBAL\";\r\n\r\n    return ctx.variableDeclaration\r\n      ? ctx.variableDeclaration.map((vd) => {\r\n          const decl = this.visit(vd) as VariableDeclaration;\r\n          decl.section = section;\r\n          return decl;\r\n        })\r\n      : [];\r\n  }\r\n\r\n  variableDeclaration(ctx: {\r\n    pragma?: CstNode[];\r\n    varName: IToken[];\r\n    typeSpec?: CstNode[];\r\n    expression?: CstNode[];\r\n    IoAddress?: IToken[];\r\n  }): VariableDeclaration {\r\n    const pragmas: PragmaNode[] = ctx.pragma\r\n      ? ctx.pragma.map((p) => this.visit(p))\r\n      : [];\r\n    const name = ctx.varName[0].image;\r\n    const dataType = ctx.typeSpec\r\n      ? this.visit(ctx.typeSpec[0])\r\n      : this.createDataType(\"UNKNOWN\");\r\n    const initialValue = ctx.expression\r\n      ? this.visit(ctx.expression[0])\r\n      : undefined;\r\n\r\n    // Create binding if IO address is present\r\n    let binding;\r\n    if (ctx.IoAddress) {\r\n      binding = this.parseIoAddress(ctx.IoAddress[0].image);\r\n\r\n      // Extract entity ID from initialValue if it's a string literal\r\n      if (\r\n        initialValue &&\r\n        initialValue.type === \"Literal\" &&\r\n        initialValue.kind === \"string\"\r\n      ) {\r\n        binding.entityId = initialValue.value as string;\r\n      }\r\n    }\r\n\r\n    return {\r\n      type: \"VariableDeclaration\",\r\n      name,\r\n      dataType,\r\n      section: \"VAR\", // Will be set by variableBlock\r\n      pragmas,\r\n      constant: false,\r\n      initialValue,\r\n      binding,\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  pragma(ctx: { Pragma: IToken[] }): PragmaNode {\r\n    const text = ctx.Pragma[0].image;\r\n    // Extract pragma content from {pragma_content}\r\n    const content = text.slice(1, -1).trim();\r\n\r\n    // Parse pragma as name: value or just name\r\n    const colonIndex = content.indexOf(\":\");\r\n    let name: string;\r\n    let value: string | undefined;\r\n\r\n    if (colonIndex > 0) {\r\n      name = content.substring(0, colonIndex).trim();\r\n      value = content.substring(colonIndex + 1).trim();\r\n    } else {\r\n      name = content;\r\n    }\r\n\r\n    return {\r\n      type: \"Pragma\",\r\n      name,\r\n      value,\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  typeSpec(ctx: {\r\n    TypeBool?: IToken[];\r\n    TypeInt?: IToken[];\r\n    TypeReal?: IToken[];\r\n    TypeString?: IToken[];\r\n    TypeTime?: IToken[];\r\n    Identifier?: IToken[];\r\n  }): DataType {\r\n    let typeName: string;\r\n\r\n    if (ctx.TypeBool) typeName = \"BOOL\";\r\n    else if (ctx.TypeInt) typeName = ctx.TypeInt[0].image;\r\n    else if (ctx.TypeReal) typeName = ctx.TypeReal[0].image;\r\n    else if (ctx.TypeString) typeName = ctx.TypeString[0].image;\r\n    else if (ctx.TypeTime) typeName = ctx.TypeTime[0].image;\r\n    else if (ctx.Identifier) typeName = ctx.Identifier[0].image;\r\n    else typeName = \"UNKNOWN\";\r\n\r\n    return this.createDataType(typeName);\r\n  }\r\n\r\n  // Statements\r\n  statement(ctx: {\r\n    assignmentStatement?: CstNode[];\r\n    ifStatement?: CstNode[];\r\n    caseStatement?: CstNode[];\r\n    forStatement?: CstNode[];\r\n    whileStatement?: CstNode[];\r\n    repeatStatement?: CstNode[];\r\n    returnStatement?: CstNode[];\r\n    exitStatement?: CstNode[];\r\n    functionCallStatement?: CstNode[];\r\n  }): Statement {\r\n    if (ctx.assignmentStatement) return this.visit(ctx.assignmentStatement[0]);\r\n    if (ctx.ifStatement) return this.visit(ctx.ifStatement[0]);\r\n    if (ctx.caseStatement) return this.visit(ctx.caseStatement[0]);\r\n    if (ctx.forStatement) return this.visit(ctx.forStatement[0]);\r\n    if (ctx.whileStatement) return this.visit(ctx.whileStatement[0]);\r\n    if (ctx.repeatStatement) return this.visit(ctx.repeatStatement[0]);\r\n    if (ctx.returnStatement) return this.visit(ctx.returnStatement[0]);\r\n    if (ctx.exitStatement) return this.visit(ctx.exitStatement[0]);\r\n    if (ctx.functionCallStatement)\r\n      return this.visit(ctx.functionCallStatement[0]);\r\n    throw new Error(\"Unknown statement type\");\r\n  }\r\n\r\n  assignmentStatement(ctx: {\r\n    variableReference: CstNode[];\r\n    expression: CstNode[];\r\n  }): AssignmentStatement {\r\n    const variable = this.visit(ctx.variableReference[0]) as VariableRef;\r\n    return {\r\n      type: \"Assignment\",\r\n      target: variable.name,\r\n      value: this.visit(ctx.expression[0]),\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  ifStatement(ctx: {\r\n    condition: CstNode[];\r\n    thenStatements?: CstNode[];\r\n    elsifCondition?: CstNode[];\r\n    elsifStatements?: CstNode[];\r\n    elseStatements?: CstNode[];\r\n  }): IfStatement {\r\n    const condition = this.visit(ctx.condition[0]);\r\n    const thenBranch = ctx.thenStatements\r\n      ? ctx.thenStatements.map((s) => this.visit(s))\r\n      : [];\r\n\r\n    const elsifBranches = ctx.elsifCondition\r\n      ? ctx.elsifCondition.map((cond, i) => {\r\n          const stmts =\r\n            ctx.elsifStatements && ctx.elsifStatements[i]\r\n              ? this.visit(ctx.elsifStatements[i])\r\n              : [];\r\n          return {\r\n            condition: this.visit(cond),\r\n            body: Array.isArray(stmts) ? stmts : [stmts],\r\n          };\r\n        })\r\n      : [];\r\n\r\n    const elseBranch = ctx.elseStatements\r\n      ? ctx.elseStatements.map((s) => this.visit(s))\r\n      : undefined;\r\n\r\n    return {\r\n      type: \"IfStatement\",\r\n      condition,\r\n      thenBranch,\r\n      elsifBranches,\r\n      elseBranch,\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  caseStatement(ctx: {\r\n    selector: CstNode[];\r\n    caseClause?: CstNode[];\r\n    statement?: CstNode[];\r\n  }): CaseStatement {\r\n    const selector = this.visit(ctx.selector[0]);\r\n    const cases = ctx.caseClause\r\n      ? ctx.caseClause.map((c) => this.visit(c))\r\n      : [];\r\n    const elseCase = ctx.statement\r\n      ? ctx.statement.map((s) => this.visit(s))\r\n      : undefined;\r\n\r\n    return {\r\n      type: \"CaseStatement\",\r\n      selector,\r\n      cases,\r\n      elseCase,\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  caseClause(ctx: { caseLabelList: CstNode[]; statement?: CstNode[] }): {\r\n    values: Expression[];\r\n    body: Statement[];\r\n  } {\r\n    const values = this.visit(ctx.caseLabelList[0]);\r\n    const body = ctx.statement ? ctx.statement.map((s) => this.visit(s)) : [];\r\n\r\n    return { values, body };\r\n  }\r\n\r\n  caseLabelList(ctx: { caseLabel: CstNode[] }): Expression[] {\r\n    return ctx.caseLabel.map((cl) => this.visit(cl));\r\n  }\r\n\r\n  caseLabel(ctx: { expression: CstNode[] }): Expression {\r\n    return this.visit(ctx.expression[0]);\r\n  }\r\n\r\n  forStatement(ctx: {\r\n    controlVar: IToken[];\r\n    start: CstNode[];\r\n    end: CstNode[];\r\n    step?: CstNode[];\r\n    statement?: CstNode[];\r\n  }): ForStatement {\r\n    return {\r\n      type: \"ForStatement\",\r\n      variable: ctx.controlVar[0].image,\r\n      from: this.visit(ctx.start[0]),\r\n      to: this.visit(ctx.end[0]),\r\n      by: ctx.step ? this.visit(ctx.step[0]) : undefined,\r\n      body: ctx.statement ? ctx.statement.map((s) => this.visit(s)) : [],\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  whileStatement(ctx: {\r\n    expression: CstNode[];\r\n    statement?: CstNode[];\r\n  }): WhileStatement {\r\n    return {\r\n      type: \"WhileStatement\",\r\n      condition: this.visit(ctx.expression[0]),\r\n      body: ctx.statement ? ctx.statement.map((s) => this.visit(s)) : [],\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  repeatStatement(ctx: {\r\n    expression: CstNode[];\r\n    statement?: CstNode[];\r\n  }): RepeatStatement {\r\n    return {\r\n      type: \"RepeatStatement\",\r\n      condition: this.visit(ctx.expression[0]),\r\n      body: ctx.statement ? ctx.statement.map((s) => this.visit(s)) : [],\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  returnStatement(ctx: CstContext): ReturnStatement {\r\n    return {\r\n      type: \"ReturnStatement\",\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  exitStatement(ctx: CstContext): ExitStatement {\r\n    return {\r\n      type: \"ExitStatement\",\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  functionCallStatement(ctx: {\r\n    functionCall: CstNode[];\r\n  }): FunctionCallStatement {\r\n    return {\r\n      type: \"FunctionCallStatement\",\r\n      call: this.visit(ctx.functionCall[0]),\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  // Expressions\r\n  expression(ctx: { orExpression: CstNode[] }): Expression {\r\n    return this.visit(ctx.orExpression[0]);\r\n  }\r\n\r\n  orExpression(ctx: {\r\n    lhs: CstNode[];\r\n    Or?: IToken[];\r\n    rhs?: CstNode[];\r\n  }): Expression {\r\n    if (!ctx.Or || ctx.Or.length === 0) {\r\n      return this.visit(ctx.lhs[0]);\r\n    }\r\n\r\n    let result: Expression = this.visit(ctx.lhs[0]);\r\n    for (let i = 0; i < ctx.Or.length; i++) {\r\n      result = {\r\n        type: \"BinaryExpression\",\r\n        operator: \"OR\",\r\n        left: result,\r\n        right: this.visit(ctx.rhs![i]),\r\n        location: this.getLocation(ctx),\r\n      };\r\n    }\r\n    return result;\r\n  }\r\n\r\n  andExpression(ctx: {\r\n    lhs: CstNode[];\r\n    And?: IToken[];\r\n    rhs?: CstNode[];\r\n  }): Expression {\r\n    if (!ctx.And || ctx.And.length === 0) {\r\n      return this.visit(ctx.lhs[0]);\r\n    }\r\n\r\n    let result: Expression = this.visit(ctx.lhs[0]);\r\n    for (let i = 0; i < ctx.And.length; i++) {\r\n      result = {\r\n        type: \"BinaryExpression\",\r\n        operator: \"AND\",\r\n        left: result,\r\n        right: this.visit(ctx.rhs![i]),\r\n        location: this.getLocation(ctx),\r\n      };\r\n    }\r\n    return result;\r\n  }\r\n\r\n  comparisonExpression(ctx: {\r\n    lhs: CstNode[];\r\n    rhs?: CstNode[];\r\n    Equal?: IToken[];\r\n    NotEqual?: IToken[];\r\n    Less?: IToken[];\r\n    LessEqual?: IToken[];\r\n    Greater?: IToken[];\r\n    GreaterEqual?: IToken[];\r\n  }): Expression {\r\n    const lhs = this.visit(ctx.lhs[0]);\r\n\r\n    if (!ctx.rhs || ctx.rhs.length === 0) {\r\n      return lhs;\r\n    }\r\n\r\n    let operator = \"=\";\r\n    if (ctx.Equal) operator = \"=\";\r\n    else if (ctx.NotEqual) operator = \"<>\";\r\n    else if (ctx.Less) operator = \"<\";\r\n    else if (ctx.LessEqual) operator = \"<=\";\r\n    else if (ctx.Greater) operator = \">\";\r\n    else if (ctx.GreaterEqual) operator = \">=\";\r\n\r\n    return {\r\n      type: \"BinaryExpression\",\r\n      operator,\r\n      left: lhs,\r\n      right: this.visit(ctx.rhs[0]),\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  additiveExpression(ctx: {\r\n    lhs: CstNode[];\r\n    rhs?: CstNode[];\r\n    Plus?: IToken[];\r\n    Minus?: IToken[];\r\n  }): Expression {\r\n    let result: Expression = this.visit(ctx.lhs[0]);\r\n\r\n    if (!ctx.Plus && !ctx.Minus) {\r\n      return result;\r\n    }\r\n\r\n    const allOps = [...(ctx.Plus || []), ...(ctx.Minus || [])]\r\n      .sort((a, b) => a.startOffset - b.startOffset)\r\n      .map((op) => op.image);\r\n\r\n    for (let i = 0; i < allOps.length; i++) {\r\n      result = {\r\n        type: \"BinaryExpression\",\r\n        operator: allOps[i],\r\n        left: result,\r\n        right: this.visit(ctx.rhs![i]),\r\n        location: this.getLocation(ctx),\r\n      };\r\n    }\r\n    return result;\r\n  }\r\n\r\n  multiplicativeExpression(ctx: {\r\n    lhs: CstNode[];\r\n    rhs?: CstNode[];\r\n    Star?: IToken[];\r\n    Slash?: IToken[];\r\n    Mod?: IToken[];\r\n  }): Expression {\r\n    let result: Expression = this.visit(ctx.lhs[0]);\r\n\r\n    if (!ctx.Star && !ctx.Slash && !ctx.Mod) {\r\n      return result;\r\n    }\r\n\r\n    const allOps = [\r\n      ...(ctx.Star || []),\r\n      ...(ctx.Slash || []),\r\n      ...(ctx.Mod || []),\r\n    ]\r\n      .sort((a, b) => a.startOffset - b.startOffset)\r\n      .map((op) => op.image);\r\n\r\n    for (let i = 0; i < allOps.length; i++) {\r\n      result = {\r\n        type: \"BinaryExpression\",\r\n        operator: allOps[i],\r\n        left: result,\r\n        right: this.visit(ctx.rhs![i]),\r\n        location: this.getLocation(ctx),\r\n      };\r\n    }\r\n    return result;\r\n  }\r\n\r\n  unaryExpression(ctx: {\r\n    Not?: IToken[];\r\n    Minus?: IToken[];\r\n    unaryExpression?: CstNode[];\r\n    primaryExpression?: CstNode[];\r\n  }): Expression {\r\n    if (ctx.Not || ctx.Minus) {\r\n      const operator = ctx.Not ? \"NOT\" : \"-\";\r\n      return {\r\n        type: \"UnaryExpression\",\r\n        operator,\r\n        operand: this.visit(ctx.unaryExpression![0]),\r\n        location: this.getLocation(ctx),\r\n      };\r\n    }\r\n\r\n    return this.visit(ctx.primaryExpression![0]);\r\n  }\r\n\r\n  primaryExpression(ctx: {\r\n    literal?: CstNode[];\r\n    identifierOrCall?: CstNode[];\r\n    expression?: CstNode[];\r\n  }): Expression {\r\n    if (ctx.literal) return this.visit(ctx.literal[0]);\r\n    if (ctx.identifierOrCall) return this.visit(ctx.identifierOrCall[0]);\r\n    if (ctx.expression) return this.visit(ctx.expression[0]);\r\n    throw new Error(\"Unknown primary expression\");\r\n  }\r\n\r\n  identifierOrCall(ctx: {\r\n    Identifier: IToken[];\r\n    LParen?: IToken[];\r\n    argumentList?: CstNode[];\r\n  }): Expression {\r\n    const parts = ctx.Identifier.map((id) => id.image);\r\n    const name = parts.join(\".\");\r\n\r\n    // If there's a function call (LParen), treat as function call\r\n    if (ctx.LParen) {\r\n      const args: FunctionArgument[] = ctx.argumentList\r\n        ? this.visit(ctx.argumentList[0])\r\n        : [];\r\n      return {\r\n        type: \"FunctionCall\",\r\n        name: parts[0], // Only use first part for function name\r\n        arguments: args,\r\n        location: this.getLocation(ctx),\r\n      };\r\n    }\r\n\r\n    // Otherwise, treat as variable reference\r\n    return {\r\n      type: \"VariableRef\",\r\n      name,\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  literal(ctx: {\r\n    True?: IToken[];\r\n    False?: IToken[];\r\n    IntegerLiteral?: IToken[];\r\n    RealLiteral?: IToken[];\r\n    StringLiteral?: IToken[];\r\n    TimeLiteral?: IToken[];\r\n  }): Literal {\r\n    let value: string | number | boolean;\r\n    let kind: \"integer\" | \"real\" | \"string\" | \"boolean\" | \"time\";\r\n    let raw: string;\r\n\r\n    if (ctx.True || ctx.False) {\r\n      value = !!ctx.True;\r\n      kind = \"boolean\";\r\n      raw = ctx.True ? \"TRUE\" : \"FALSE\";\r\n    } else if (ctx.IntegerLiteral) {\r\n      raw = ctx.IntegerLiteral[0].image;\r\n      value = parseInt(raw, 10);\r\n      kind = \"integer\";\r\n    } else if (ctx.RealLiteral) {\r\n      raw = ctx.RealLiteral[0].image;\r\n      value = parseFloat(raw);\r\n      kind = \"real\";\r\n    } else if (ctx.StringLiteral) {\r\n      raw = ctx.StringLiteral[0].image;\r\n      // Remove surrounding quotes and handle escaped quotes\r\n      value = raw.slice(1, -1).replace(/''/g, \"'\");\r\n      kind = \"string\";\r\n    } else if (ctx.TimeLiteral) {\r\n      raw = ctx.TimeLiteral[0].image;\r\n      value = raw;\r\n      kind = \"time\";\r\n    } else {\r\n      // Fallback for unexpected literals 窶 treat as integer 0\r\n      raw = \"0\";\r\n      value = 0;\r\n      kind = \"integer\";\r\n    }\r\n\r\n    return {\r\n      type: \"Literal\",\r\n      kind,\r\n      value,\r\n      raw,\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  variableReference(ctx: { Identifier: IToken[] }): VariableRef {\r\n    const parts = ctx.Identifier.map((id) => id.image);\r\n\r\n    // For now, just return the first part as name\r\n    // In the future, we could handle member access properly\r\n    return {\r\n      type: \"VariableRef\",\r\n      name: parts.join(\".\"),\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  functionCall(ctx: {\r\n    Identifier: IToken[];\r\n    argumentList?: CstNode[];\r\n  }): FunctionCall {\r\n    const name = ctx.Identifier[0].image;\r\n    const args: FunctionArgument[] = ctx.argumentList\r\n      ? this.visit(ctx.argumentList[0])\r\n      : [];\r\n\r\n    return {\r\n      type: \"FunctionCall\",\r\n      name,\r\n      arguments: args,\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  argumentList(ctx: { argument: CstNode[] }): FunctionArgument[] {\r\n    return ctx.argument.map((a) => this.visit(a));\r\n  }\r\n\r\n  argument(ctx: {\r\n    argName?: IToken[];\r\n    argValue?: CstNode[];\r\n    expression?: CstNode[];\r\n  }): FunctionArgument {\r\n    const name = ctx.argName ? ctx.argName[0].image : undefined;\r\n    const valueExpr: Expression = ctx.argValue\r\n      ? this.visit(ctx.argValue[0])\r\n      : this.visit(ctx.expression![0]);\r\n\r\n    return {\r\n      type: \"FunctionArgument\",\r\n      name,\r\n      value: valueExpr,\r\n      location: this.getLocation(ctx),\r\n    };\r\n  }\r\n\r\n  // Helper methods\r\n  private createDataType(name: string): DataType {\r\n    return {\r\n      type: \"DataType\",\r\n      name,\r\n    };\r\n  }\r\n\r\n  private parseIoAddress(address: string): EntityBinding {\r\n    // Parse %I0.0, %Q0.1, %M*, etc.\r\n    // Remove the % prefix to get the IO address\r\n    const ioAddress = address.substring(1);\r\n    const direction =\r\n      address[1] === \"I\" ? \"INPUT\" : address[1] === \"Q\" ? \"OUTPUT\" : \"MEMORY\";\r\n\r\n    return {\r\n      type: \"EntityBinding\",\r\n      direction,\r\n      ioAddress,\r\n      // entityId will be set from initialValue if present\r\n    };\r\n  }\r\n\r\n  private getLocation(ctx: CstContext): SourceLocation | undefined {\r\n    // Extract location from first and last tokens\r\n    const tokens = this.getAllTokens(ctx);\r\n    if (tokens.length === 0) return undefined;\r\n\r\n    const first = tokens[0];\r\n    const last = tokens[tokens.length - 1];\r\n\r\n    return {\r\n      startLine: first.startLine || 0,\r\n      startColumn: first.startColumn || 0,\r\n      endLine: last.endLine || last.startLine || 0,\r\n      endColumn: last.endColumn || last.startColumn || 0,\r\n    };\r\n  }\r\n\r\n  private getAllTokens(ctx: CstContext): IToken[] {\r\n    const tokens: IToken[] = [];\r\n    for (const key in ctx) {\r\n      if (Array.isArray(ctx[key])) {\r\n        for (const item of ctx[key]) {\r\n          if (item && typeof item === \"object\" && \"image\" in item) {\r\n            tokens.push(item as IToken);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return tokens.sort((a, b) => a.startOffset - b.startOffset);\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const visitor = new STVisitor();\r\n","/**\r\n * ST Parser Main Entry Point\r\n * Coordinates lexing, parsing, and AST transformation\r\n */\r\n\r\nimport { tokenize } from './lexer';\r\nimport { parserInstance } from './parser';\r\nimport { visitor } from './visitor';\r\nimport type { ProgramNode } from './ast';\r\n\r\nexport interface ParseResult {\r\n  success: boolean;\r\n  ast?: ProgramNode;\r\n  errors: ParseError[];\r\n}\r\n\r\nexport interface ParseError {\r\n  message: string;\r\n  line?: number;\r\n  column?: number;\r\n  offset?: number;\r\n}\r\n\r\n/**\r\n * Parse Structured Text code into an AST\r\n * @param code The ST source code to parse\r\n * @returns ParseResult with AST or errors\r\n */\r\nexport function parse(code: string): ParseResult {\r\n  const errors: ParseError[] = [];\r\n\r\n  // Step 1: Tokenize\r\n  const lexResult = tokenize(code);\r\n\r\n  if (lexResult.errors.length > 0) {\r\n    lexResult.errors.forEach(error => {\r\n      errors.push({\r\n        message: error.message,\r\n        line: error.line,\r\n        column: error.column,\r\n        offset: error.offset,\r\n      });\r\n    });\r\n  }\r\n\r\n  // If there are lexing errors, don't proceed to parsing\r\n  if (errors.length > 0) {\r\n    return {\r\n      success: false,\r\n      errors,\r\n    };\r\n  }\r\n\r\n  // Step 2: Parse tokens into CST\r\n  parserInstance.input = lexResult.tokens;\r\n  const cst = parserInstance.program();\r\n\r\n  // Step 3: Check for parser errors\r\n  if (parserInstance.errors.length > 0) {\r\n    parserInstance.errors.forEach(error => {\r\n      errors.push({\r\n        message: error.message,\r\n        line: error.token.startLine,\r\n        column: error.token.startColumn,\r\n        offset: error.token.startOffset,\r\n      });\r\n    });\r\n\r\n    return {\r\n      success: false,\r\n      errors,\r\n    };\r\n  }\r\n\r\n  // Step 4: Transform CST to AST\r\n  try {\r\n    const ast = visitor.visit(cst) as ProgramNode;\r\n\r\n    return {\r\n      success: true,\r\n      ast,\r\n      errors: [],\r\n    };\r\n  } catch (error) {\r\n    errors.push({\r\n      message: error instanceof Error ? error.message : 'Unknown AST transformation error',\r\n    });\r\n\r\n    return {\r\n      success: false,\r\n      errors,\r\n    };\r\n  }\r\n}\r\n\r\n// Re-export types and utilities\r\nexport * from './ast';\r\nexport { tokenize } from './lexer';\r\nexport { parserInstance } from './parser';\r\nexport { visitor } from './visitor';\r\nexport { allTokens } from './tokens';\r\n","import { LitElement, html, css } from \"lit\";\r\nimport { customElement, property, state } from \"lit/decorators.js\";\r\nimport \"../editor\";\r\nimport \"../online/online-toolbar\";\r\n// Entity browser and project explorer are lazy loaded when shown\r\n// import \"../entity-browser\";\r\n// import \"../project\";\r\nimport { parse } from \"../parser\";\r\nimport { analyzeDependencies } from \"../analyzer\";\r\nimport type {\r\n  TriggerConfig,\r\n  AnalysisMetadata,\r\n  EntityDependency,\r\n} from \"../analyzer/types\";\r\n// Transpiler and deploy are lazy loaded when deploy is triggered\r\n// import { transpile } from \"../transpiler\";\r\n// import { deploy, HAApiClient } from \"../deploy\";\r\nimport type { VariableBinding, OnlineModeState } from \"../online/types\";\r\nimport type { STEditor } from \"../editor/st-editor\";\r\nimport type { ProjectStructure, ProjectFile } from \"../project/types\";\r\nimport type { ProjectStorage } from \"../project\";\r\n\r\ninterface CombinedDiagnostic {\r\n  severity: \"Error\" | \"Warning\" | \"Info\" | \"Hint\";\r\n  code?: string;\r\n  message: string;\r\n  line?: number;\r\n  column?: number;\r\n}\r\n\r\n@customElement(\"st-panel\")\r\nexport class STPanel extends LitElement {\r\n  @property({ attribute: false }) declare public hass?: any;\r\n  @property({ type: Boolean }) declare public narrow: boolean;\r\n\r\n  @state() declare private _code: string; // Legacy single-file mode\r\n  @state() declare private _project: ProjectStructure | null; // Multi-file mode\r\n  @state() declare private _syntaxOk: boolean;\r\n  @state() declare private _triggers: TriggerConfig[];\r\n  @state() declare private _diagnostics: CombinedDiagnostic[];\r\n  @state() declare private _metadata: AnalysisMetadata | null;\r\n  @state() declare private _entityCount: number;\r\n  @state() declare private _onlineState: OnlineModeState | null;\r\n  @state() declare private _showEntityBrowser: boolean;\r\n  @state() declare private _showProjectExplorer: boolean;\r\n  @state() declare private _storage: ProjectStorage | null;\r\n  private _entityBrowserLoaded = false;\r\n  private _projectExplorerLoaded = false;\r\n\r\n  static styles = css`\r\n    :host {\r\n      display: block;\r\n      height: 100%;\r\n      background: var(--primary-background-color);\r\n    }\r\n    .container {\r\n      display: flex;\r\n      flex-direction: column;\r\n      height: 100%;\r\n    }\r\n    .main-content {\r\n      display: flex;\r\n      flex: 1;\r\n      overflow: hidden;\r\n    }\r\n    .sidebar {\r\n      width: 320px;\r\n      min-width: 280px;\r\n      max-width: 400px;\r\n      border-right: 1px solid var(--divider-color);\r\n      display: flex;\r\n      flex-direction: column;\r\n      background: var(--primary-background-color);\r\n      overflow: hidden;\r\n    }\r\n    .sidebar.hidden {\r\n      display: none;\r\n    }\r\n    .content-area {\r\n      flex: 1;\r\n      display: flex;\r\n      flex-direction: column;\r\n      overflow: hidden;\r\n    }\r\n    .toolbar {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      padding: 8px 16px;\r\n      background: var(--app-header-background-color);\r\n      color: var(--app-header-text-color);\r\n      border-bottom: 1px solid var(--divider-color);\r\n    }\r\n    .toolbar h1 {\r\n      margin: 0;\r\n      font-size: 20px;\r\n    }\r\n    .toolbar-actions {\r\n      display: flex;\r\n      gap: 8px;\r\n      align-items: center;\r\n    }\r\n    .toolbar-button {\r\n      padding: 6px 12px;\r\n      border: 1px solid var(--divider-color);\r\n      border-radius: 4px;\r\n      background: var(--secondary-background-color);\r\n      color: var(--primary-text-color);\r\n      cursor: pointer;\r\n      font-size: 14px;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 4px;\r\n    }\r\n    .toolbar-button:hover {\r\n      background: var(--divider-color);\r\n    }\r\n    .toolbar-button.active {\r\n      background: var(--primary-color);\r\n      color: var(--text-primary-color);\r\n      border-color: var(--primary-color);\r\n    }\r\n    .editor-container {\r\n      flex: 1;\r\n      overflow: hidden;\r\n      padding: 16px;\r\n    }\r\n    st-editor {\r\n      height: 100%;\r\n      border-radius: 4px;\r\n    }\r\n    .status-bar {\r\n      display: flex;\r\n      gap: 16px;\r\n      padding: 8px 16px;\r\n      background: var(--secondary-background-color);\r\n      border-top: 1px solid var(--divider-color);\r\n      font-size: 12px;\r\n      flex-wrap: wrap;\r\n    }\r\n    .status-ok {\r\n      color: var(--success-color, #4caf50);\r\n    }\r\n    .status-error {\r\n      color: var(--error-color, #f44336);\r\n    }\r\n    .status-warning {\r\n      color: var(--warning-color, #ff9800);\r\n    }\r\n    button {\r\n      padding: 8px 16px;\r\n      border: none;\r\n      border-radius: 4px;\r\n      background: var(--primary-color);\r\n      color: var(--text-primary-color);\r\n      cursor: pointer;\r\n    }\r\n    button:disabled {\r\n      opacity: 0.5;\r\n      cursor: not-allowed;\r\n    }\r\n    .diagnostics-panel {\r\n      max-height: 150px;\r\n      overflow-y: auto;\r\n      padding: 8px 16px;\r\n      background: var(--secondary-background-color);\r\n      border-top: 1px solid var(--divider-color);\r\n      font-size: 12px;\r\n      font-family: monospace;\r\n    }\r\n    .diagnostic {\r\n      padding: 2px 0;\r\n    }\r\n    .diagnostic-error {\r\n      color: var(--error-color, #f44336);\r\n    }\r\n    .diagnostic-warning {\r\n      color: var(--warning-color, #ff9800);\r\n    }\r\n    .diagnostic-info {\r\n      color: var(--info-color, #2196f3);\r\n    }\r\n    .diagnostic-hint {\r\n      color: var(--disabled-text-color, #9e9e9e);\r\n    }\r\n    .tabs-container {\r\n      display: flex;\r\n      gap: 2px;\r\n      padding: 0 8px;\r\n      background: var(--secondary-background-color);\r\n      border-bottom: 1px solid var(--divider-color);\r\n      overflow-x: auto;\r\n    }\r\n    .tab {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 6px;\r\n      padding: 8px 12px;\r\n      background: var(--secondary-background-color);\r\n      color: var(--primary-text-color);\r\n      cursor: pointer;\r\n      border: none;\r\n      border-bottom: 2px solid transparent;\r\n      font-size: 13px;\r\n      white-space: nowrap;\r\n      transition: all 0.2s;\r\n    }\r\n    .tab:hover {\r\n      background: var(--divider-color);\r\n    }\r\n    .tab.active {\r\n      background: var(--card-background-color);\r\n      border-bottom-color: var(--primary-color);\r\n      color: var(--primary-text-color);\r\n    }\r\n    .tab-close {\r\n      width: 16px;\r\n      height: 16px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      border-radius: 2px;\r\n      opacity: 0.6;\r\n    }\r\n    .tab-close:hover {\r\n      opacity: 1;\r\n      background: var(--divider-color);\r\n    }\r\n    .unsaved-dot {\r\n      width: 6px;\r\n      height: 6px;\r\n      border-radius: 50%;\r\n      background-color: var(--warning-color, #ff9800);\r\n    }\r\n    .project-sidebar {\r\n      width: 280px;\r\n      min-width: 240px;\r\n      max-width: 360px;\r\n      border-right: 1px solid var(--divider-color);\r\n      display: flex;\r\n      flex-direction: column;\r\n      background: var(--primary-background-color);\r\n    }\r\n    .project-sidebar.hidden {\r\n      display: none;\r\n    }\r\n  `;\r\n\r\n  constructor() {\r\n    super();\r\n    this.narrow = false;\r\n    this._showEntityBrowser = false;\r\n    this._showProjectExplorer = false;\r\n    this._project = null;\r\n    this._storage = null;\r\n    this._code = `{mode: restart}\r\n{throttle: T#1s}\r\nPROGRAM Kitchen_Light\r\nVAR\r\n    {trigger}\r\n    motion AT %I* : BOOL := 'binary_sensor.kitchen_motion';\r\n\r\n    {no_trigger}\r\n    temperature AT %I* : REAL := 'sensor.kitchen_temperature';\r\n\r\n    {persistent}\r\n    activationCount : INT := 0;\r\n\r\n    light AT %Q* : BOOL := 'light.kitchen';\r\nEND_VAR\r\n\r\n(* Main logic *)\r\nIF motion THEN\r\n    light := TRUE;\r\n    activationCount := activationCount + 1;\r\nELSE\r\n    light := FALSE;\r\nEND_IF\r\n\r\nEND_PROGRAM`;\r\n    this._syntaxOk = true;\r\n    this._triggers = [];\r\n    this._diagnostics = [];\r\n    this._metadata = null;\r\n    this._entityCount = 0;\r\n    this._onlineState = null;\r\n  }\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    this._initializeProject();\r\n    // Run initial analysis\r\n    this._analyzeCode();\r\n  }\r\n\r\n  updated(changedProperties: Map<string | number | symbol, unknown>): void {\r\n    super.updated(changedProperties);\r\n    if (changedProperties.has(\"hass\")) {\r\n      this._initializeStorage().then(() => {\r\n        if (!this._project) {\r\n          this._initializeProject();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private async _initializeStorage(): Promise<void> {\r\n    if (this._storage) return; // Already initialized\r\n    \r\n    // Lazy load ProjectStorage module\r\n    const { ProjectStorage } = await import(\"../project\");\r\n    \r\n    if (this.hass?.connection) {\r\n      const configEntryId = this.hass.config?.entry_id || \"default\";\r\n      this._storage = new ProjectStorage(this.hass.connection, configEntryId);\r\n    } else {\r\n      this._storage = new ProjectStorage(null, \"default\");\r\n    }\r\n  }\r\n\r\n  private async _initializeProject(): Promise<void> {\r\n    if (!this._storage) {\r\n      await this._initializeStorage();\r\n    }\r\n\r\n    if (this._storage) {\r\n      try {\r\n        const project = await this._storage.loadProject();\r\n        if (project) {\r\n          this._project = project;\r\n          // Open the active file if any\r\n          if (project.activeFileId) {\r\n            const activeFile = project.files.find(\r\n              (f) => f.id === project.activeFileId,\r\n            );\r\n            if (activeFile) {\r\n              this._code = activeFile.content;\r\n            }\r\n          }\r\n        } else {\r\n          // Migrate from single-file mode\r\n          this._project = this._storage.migrateFromSingleFile(this._code);\r\n          await this._storage.saveProject(this._project);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Failed to load project\", error);\r\n        // Fall back to single-file mode\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const errorCount = this._diagnostics.filter(\r\n      (d) => d.severity === \"Error\",\r\n    ).length;\r\n    const warningCount = this._diagnostics.filter(\r\n      (d) => d.severity === \"Warning\",\r\n    ).length;\r\n\r\n    return html`\r\n      <div class=\"container\">\r\n        <div class=\"toolbar\">\r\n          <h1>ST for Home Assistant</h1>\r\n          <div class=\"toolbar-actions\">\r\n            <button\r\n              class=\"toolbar-button ${this._showProjectExplorer\r\n                ? \"active\"\r\n                : \"\"}\"\r\n              @click=${this._toggleProjectExplorer}\r\n              title=\"Toggle Project Explorer\"\r\n            >\r\n              <ha-icon icon=\"mdi:folder\"></ha-icon>\r\n              Project\r\n            </button>\r\n            <button\r\n              class=\"toolbar-button ${this._showEntityBrowser ? \"active\" : \"\"}\"\r\n              @click=${this._toggleEntityBrowser}\r\n              title=\"Toggle Entity Browser\"\r\n            >\r\n              <ha-icon icon=\"mdi:format-list-bulleted\"></ha-icon>\r\n              Entities\r\n            </button>\r\n            <button @click=${this._handleDeploy} ?disabled=${!this._syntaxOk}>\r\n              笆ｶ Deploy\r\n            </button>\r\n          </div>\r\n        </div>\r\n        ${this._onlineState\r\n          ? html`\r\n              <st-online-toolbar\r\n                .state=${this._onlineState}\r\n                @connect=${this._handleOnlineConnect}\r\n                @disconnect=${this._handleOnlineDisconnect}\r\n                @toggle-pause=${this._handleOnlineTogglePause}\r\n                @setting-change=${this._handleOnlineSettingChange}\r\n              ></st-online-toolbar>\r\n            `\r\n          : \"\"}\r\n        <div class=\"main-content\">\r\n          ${this._showProjectExplorer\r\n            ? html`\r\n                <div class=\"project-sidebar\">\r\n                  <st-project-explorer\r\n                    .hass=${this.hass}\r\n                    .project=${this._project}\r\n                    @file-open=${this._handleFileOpen}\r\n                    @file-selected=${this._handleFileSelected}\r\n                    @file-rename=${this._handleFileRename}\r\n                    @file-deleted=${this._handleFileDeleted}\r\n                    @file-created=${this._handleFileCreated}\r\n                  ></st-project-explorer>\r\n                </div>\r\n              `\r\n            : \"\"}\r\n          <div class=\"sidebar ${this._showEntityBrowser ? \"\" : \"hidden\"}\">\r\n            <st-entity-browser .hass=${this.hass}></st-entity-browser>\r\n          </div>\r\n          <div class=\"content-area\">\r\n            ${this._project\r\n              ? html`\r\n                  <div class=\"tabs-container\">\r\n                    ${this._getOpenFiles().map(\r\n                      (file) => html`\r\n                        <button\r\n                          class=\"tab ${file.id === this._project!.activeFileId\r\n                            ? \"active\"\r\n                            : \"\"}\"\r\n                          @click=${() => this._switchToFile(file.id)}\r\n                          title=${file.path}\r\n                        >\r\n                          <span>${file.name}</span>\r\n                          ${file.hasUnsavedChanges\r\n                            ? html`<div class=\"unsaved-dot\"></div>`\r\n                            : \"\"}\r\n                          <div\r\n                            class=\"tab-close\"\r\n                            @click=${(e: Event) => {\r\n                              e.stopPropagation();\r\n                              this._closeFile(file.id);\r\n                            }}\r\n                            title=\"Close\"\r\n                          >\r\n                            <ha-icon\r\n                              icon=\"mdi:close\"\r\n                              style=\"width: 12px; height: 12px;\"\r\n                            ></ha-icon>\r\n                          </div>\r\n                        </button>\r\n                      `,\r\n                    )}\r\n                  </div>\r\n                `\r\n              : \"\"}\r\n            <div class=\"editor-container\">\r\n              <st-editor\r\n                .code=${this._getCurrentCode()}\r\n                .hass=${this.hass}\r\n                @code-change=${this._handleCodeChange}\r\n              ></st-editor>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        ${this._diagnostics.length > 0\r\n          ? html`\r\n              <div class=\"diagnostics-panel\">\r\n                ${this._diagnostics.map(\r\n                  (d) => html`\r\n                    <div\r\n                      class=\"diagnostic diagnostic-${d.severity.toLowerCase()}\"\r\n                    >\r\n                      ${d.line ? `[${d.line}:${d.column || 0}] ` : \"\"}${d.code\r\n                        ? `${d.code}: `\r\n                        : \"\"}${d.message}\r\n                    </div>\r\n                  `,\r\n                )}\r\n              </div>\r\n            `\r\n          : \"\"}\r\n        <div class=\"status-bar\">\r\n          ${this._syntaxOk\r\n            ? html`<span class=\"status-ok\">笨 Syntax OK</span>`\r\n            : html`<span class=\"status-error\">笨 Syntax Error</span>`}\r\n          ${errorCount > 0\r\n            ? html`<span class=\"status-error\">${errorCount} Error(s)</span>`\r\n            : \"\"}\r\n          ${warningCount > 0\r\n            ? html`<span class=\"status-warning\"\r\n                >${warningCount} Warning(s)</span\r\n              >`\r\n            : \"\"}\r\n          <span>Triggers: ${this._triggers.length}</span>\r\n          <span>Entities: ${this._entityCount}</span>\r\n          ${this._metadata?.mode\r\n            ? html`<span>Mode: ${this._metadata.mode}</span>`\r\n            : \"\"}\r\n          ${this._metadata?.hasPersistentVars\r\n            ? html`<span>汳ｾ Persistent</span>`\r\n            : \"\"}\r\n          ${this._metadata?.hasTimers ? html`<span>竢ｱｸ Timers</span>` : \"\"}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private _handleCodeChange(e: CustomEvent<{ code: string }>) {\r\n    const newCode = e.detail.code;\r\n\r\n    if (this._project && this._project.activeFileId) {\r\n      // Update active file in project\r\n      const activeFile = this._project.files.find(\r\n        (f) => f.id === this._project!.activeFileId,\r\n      );\r\n      if (activeFile) {\r\n        activeFile.content = newCode;\r\n        // Mark as unsaved if content differs from what was last saved\r\n        // We'll track the \"saved\" state separately - for now, mark as unsaved if changed\r\n        activeFile.hasUnsavedChanges = true; // Will be cleared on save\r\n        activeFile.lastModified = Date.now();\r\n        this._project.lastModified = Date.now();\r\n        // Don't auto-save on every keystroke - just update in-memory state\r\n      }\r\n    } else {\r\n      // Legacy single-file mode\r\n      this._code = newCode;\r\n    }\r\n\r\n    this._analyzeCode();\r\n  }\r\n\r\n  private _getCurrentCode(): string {\r\n    if (this._project && this._project.activeFileId) {\r\n      const activeFile = this._project.files.find(\r\n        (f) => f.id === this._project!.activeFileId,\r\n      );\r\n      return activeFile?.content || \"\";\r\n    }\r\n    return this._code;\r\n  }\r\n\r\n  private _getOpenFiles(): ProjectFile[] {\r\n    if (!this._project) return [];\r\n    return this._project.files.filter((f) => f.isOpen);\r\n  }\r\n\r\n  private _switchToFile(fileId: string): void {\r\n    if (!this._project) return;\r\n\r\n    const file = this._project.files.find((f) => f.id === fileId);\r\n    if (!file) return;\r\n\r\n    // Save current file content from editor before switching\r\n    const editor = this.shadowRoot?.querySelector(\r\n      \"st-editor\",\r\n    ) as STEditor | null;\r\n    if (editor && this._project.activeFileId) {\r\n      const currentFile = this._project.files.find(\r\n        (f) => f.id === this._project!.activeFileId,\r\n      );\r\n      if (currentFile) {\r\n        const editorCode = editor.getCode();\r\n        // Only update if content actually changed\r\n        if (editorCode !== currentFile.content) {\r\n          currentFile.content = editorCode;\r\n          currentFile.hasUnsavedChanges = true;\r\n          currentFile.lastModified = Date.now();\r\n        }\r\n      }\r\n    }\r\n\r\n    // Switch to new file\r\n    this._project.activeFileId = fileId;\r\n    this._project.files.forEach((f) => {\r\n      f.isOpen = f.id === fileId || f.isOpen;\r\n    });\r\n    this._project.lastModified = Date.now();\r\n\r\n    // Update editor with new file content\r\n    if (editor) {\r\n      editor.setCode(file.content);\r\n    }\r\n\r\n    this._saveProject();\r\n    this.requestUpdate();\r\n  }\r\n\r\n  private _closeFile(fileId: string): void {\r\n    if (!this._project) return;\r\n\r\n    const file = this._project.files.find((f) => f.id === fileId);\r\n    if (!file) return;\r\n\r\n    // Check for unsaved changes\r\n    if (file.hasUnsavedChanges) {\r\n      if (!confirm(`File \"${file.name}\" has unsaved changes. Close anyway?`)) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Close file\r\n    file.isOpen = false;\r\n\r\n    // If this was the active file, switch to another open file\r\n    if (this._project.activeFileId === fileId) {\r\n      const openFiles = this._project.files.filter(\r\n        (f) => f.isOpen && f.id !== fileId,\r\n      );\r\n      this._project.activeFileId =\r\n        openFiles.length > 0 ? openFiles[0].id : null;\r\n    }\r\n\r\n    this._project.lastModified = Date.now();\r\n    this._saveProject();\r\n    this.requestUpdate();\r\n  }\r\n\r\n  private _handleFileOpen(e: CustomEvent): void {\r\n    const { fileId } = e.detail;\r\n    this._switchToFile(fileId);\r\n  }\r\n\r\n  private _handleFileSelected(_e: CustomEvent): void {\r\n    // Just update selection, don't switch yet\r\n    // Could be used for preview or other features\r\n  }\r\n\r\n  private _handleFileRename(e: CustomEvent): void {\r\n    const { fileId, newName } = e.detail;\r\n    if (!this._project) return;\r\n\r\n    const file = this._project.files.find((f) => f.id === fileId);\r\n    if (file) {\r\n      file.name = newName;\r\n      file.path = newName; // Simple: path = name for now\r\n      file.lastModified = Date.now();\r\n      this._project.lastModified = Date.now();\r\n      this._saveProject();\r\n    }\r\n  }\r\n\r\n  private _handleFileDeleted(e: CustomEvent): void {\r\n    const { fileId } = e.detail;\r\n    this._closeFile(fileId);\r\n  }\r\n\r\n  private _handleFileCreated(e: CustomEvent): void {\r\n    const { file } = e.detail;\r\n    if (!this._project || !file) return;\r\n\r\n    // Add the new file to the project\r\n    this._project = {\r\n      ...this._project,\r\n      files: [...this._project.files, file],\r\n      activeFileId: file.id,\r\n      lastModified: Date.now(),\r\n    };\r\n\r\n    // Update editor with new file content\r\n    const editor = this.shadowRoot?.querySelector(\r\n      \"st-editor\",\r\n    ) as STEditor | null;\r\n    if (editor) {\r\n      editor.setCode(file.content);\r\n    }\r\n\r\n    this._saveProject();\r\n    this._analyzeCode();\r\n    this.requestUpdate();\r\n  }\r\n\r\n  private async _saveProject(): Promise<void> {\r\n    if (!this._storage || !this._project) return;\r\n    try {\r\n      await this._storage.saveProject(this._project);\r\n    } catch (error) {\r\n      console.error(\"Failed to save project\", error);\r\n    }\r\n  }\r\n\r\n  private async _toggleProjectExplorer(): Promise<void> {\r\n    if (!this._projectExplorerLoaded && !this._showProjectExplorer) {\r\n      // Lazy load project explorer module when first shown\r\n      await import(\"../project\");\r\n      this._projectExplorerLoaded = true;\r\n    }\r\n    this._showProjectExplorer = !this._showProjectExplorer;\r\n  }\r\n\r\n  /**\r\n   * Parse and analyze the current code\r\n   * Updates all reactive state with results\r\n   */\r\n  private _analyzeCode(): void {\r\n    const diagnostics: CombinedDiagnostic[] = [];\r\n\r\n    // Step 1: Parse the code (use current code from project or legacy mode)\r\n    const code = this._getCurrentCode();\r\n    const parseResult = parse(code);\r\n\r\n    // Convert parser errors to combined diagnostics\r\n    if (parseResult.errors.length > 0) {\r\n      for (const error of parseResult.errors) {\r\n        diagnostics.push({\r\n          severity: \"Error\",\r\n          message: error.message,\r\n          line: error.line,\r\n          column: error.column,\r\n        });\r\n      }\r\n    }\r\n\r\n    this._syntaxOk = parseResult.success && parseResult.ast !== undefined;\r\n\r\n    // Step 2: If parsing succeeded, run dependency analysis\r\n    if (parseResult.success && parseResult.ast) {\r\n      const analysis = analyzeDependencies(parseResult.ast);\r\n\r\n      // Add analyzer diagnostics\r\n      for (const diag of analysis.diagnostics) {\r\n        diagnostics.push({\r\n          severity: diag.severity,\r\n          code: diag.code,\r\n          message: diag.message,\r\n          line: diag.location?.line,\r\n          column: diag.location?.column,\r\n        });\r\n      }\r\n\r\n      this._triggers = analysis.triggers;\r\n      this._metadata = analysis.metadata;\r\n      this._entityCount = analysis.dependencies.length;\r\n    } else {\r\n      // Reset analysis state on parse failure\r\n      this._triggers = [];\r\n      this._metadata = null;\r\n      this._entityCount = 0;\r\n    }\r\n\r\n    this._diagnostics = diagnostics;\r\n  }\r\n\r\n  private async _handleDeploy() {\r\n    if (!this._syntaxOk) {\r\n      console.error(\"Cannot deploy: syntax errors present\");\r\n      return;\r\n    }\r\n\r\n    if (!this.hass?.connection) {\r\n      console.error(\r\n        \"Cannot deploy: Home Assistant connection is not available\",\r\n      );\r\n      return;\r\n    }\r\n\r\n    const parseResult = parse(this._code);\r\n    if (!parseResult.success || !parseResult.ast) {\r\n      console.error(\"Cannot deploy: parsing failed\");\r\n      return;\r\n    }\r\n\r\n    // Lazy load transpiler and deploy modules\r\n    const [{ transpile }, { deploy, HAApiClient }] = await Promise.all([\r\n      import(\"../transpiler\"),\r\n      import(\"../deploy\"),\r\n    ]);\r\n\r\n    const transpilerResult = transpile(parseResult.ast, \"home\");\r\n    if (transpilerResult.diagnostics.some((d) => d.severity === \"Error\")) {\r\n      console.error(\r\n        \"Cannot deploy: transpiler reported errors\",\r\n        transpilerResult.diagnostics,\r\n      );\r\n      return;\r\n    }\r\n\r\n    const api = new HAApiClient(this.hass.connection);\r\n    try {\r\n      const deployResult = await deploy(api, transpilerResult, {\r\n        createBackup: true,\r\n      });\r\n      if (!deployResult.success) {\r\n        console.error(\"Deploy failed\", deployResult.errors);\r\n      } else {\r\n        // eslint-disable-next-line no-console\r\n        console.log(\"Deploy successful\", deployResult.transactionId);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Deploy error\", error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Extract variable bindings from AST for online mode\r\n   */\r\n  private _extractBindings(\r\n    dependencies: EntityDependency[],\r\n  ): VariableBinding[] {\r\n    const bindings: VariableBinding[] = [];\r\n\r\n    for (const dep of dependencies) {\r\n      if (!dep.entityId || !dep.location) continue;\r\n\r\n      bindings.push({\r\n        variableName: dep.variableName,\r\n        entityId: dep.entityId,\r\n        dataType: dep.dataType,\r\n        line: dep.location.line,\r\n        column: dep.location.column,\r\n        endColumn: dep.location.column + dep.variableName.length,\r\n        isInput: dep.direction === \"INPUT\",\r\n        isOutput: dep.direction === \"OUTPUT\",\r\n        isPersistent: false, // Will be determined from storage analysis if needed\r\n      });\r\n    }\r\n\r\n    return bindings;\r\n  }\r\n\r\n  private async _handleOnlineConnect(): Promise<void> {\r\n    if (!this._syntaxOk || !this.hass?.connection) {\r\n      return;\r\n    }\r\n\r\n    const parseResult = parse(this._code);\r\n    if (!parseResult.success || !parseResult.ast) {\r\n      return;\r\n    }\r\n\r\n    const analysis = analyzeDependencies(parseResult.ast);\r\n    const bindings = this._extractBindings(analysis.dependencies);\r\n\r\n    const editor = this.shadowRoot?.querySelector(\r\n      \"st-editor\",\r\n    ) as STEditor | null;\r\n    if (editor) {\r\n      try {\r\n        await editor.startOnlineMode(bindings);\r\n        this._onlineState = editor.getOnlineState();\r\n      } catch (error) {\r\n        console.error(\"Failed to start online mode\", error);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _handleOnlineDisconnect(): void {\r\n    const editor = this.shadowRoot?.querySelector(\r\n      \"st-editor\",\r\n    ) as STEditor | null;\r\n    if (editor) {\r\n      editor.stopOnlineMode();\r\n      this._onlineState = null;\r\n    }\r\n  }\r\n\r\n  private _handleOnlineTogglePause(): void {\r\n    const editor = this.shadowRoot?.querySelector(\r\n      \"st-editor\",\r\n    ) as STEditor | null;\r\n    if (editor && this._onlineState) {\r\n      const isPaused = this._onlineState.status === \"paused\";\r\n      editor.setOnlinePaused(!isPaused);\r\n      this._onlineState = editor.getOnlineState();\r\n    }\r\n  }\r\n\r\n  private _handleOnlineSettingChange(e: CustomEvent): void {\r\n    // Settings changes would update the manager, but for now we just log\r\n    // eslint-disable-next-line no-console\r\n    console.log(\"Online setting changed\", e.detail);\r\n  }\r\n\r\n  private async _toggleEntityBrowser(): Promise<void> {\r\n    if (!this._entityBrowserLoaded && !this._showEntityBrowser) {\r\n      // Lazy load entity browser module when first shown\r\n      await import(\"../entity-browser\");\r\n      this._entityBrowserLoaded = true;\r\n    }\r\n    this._showEntityBrowser = !this._showEntityBrowser;\r\n  }\r\n}\r\n","/**\r\n * ST for Home Assistant - Frontend Entry Point\r\n */\r\nexport * from \"./editor\";\r\nimport \"./panel/st-panel\";\r\n\r\nconsole.log(\"ST for Home Assistant loaded\");\r\n"],"names":["ST_KEYWORDS","ST_TYPES","ST_BUILTINS","ST_FUNCTION_BLOCKS","ST_PRAGMAS","stLanguage","StreamLanguage","state","stream","depth","ch","word","stCompletion","completeFromList","k","t","f","fb","p","structuredText","LanguageSupport","colors","stEditorTheme","EditorView","stHighlightStyle","HighlightStyle","stTheme","syntaxHighlighting","OnlineStateManager","connection","__publicField","bindings","binding","subscribeEntities","entities","error","paused","callback","variableName","converted","entityId","hassEntity","now","varName","entityState","currentValue","existingLive","liveValue","raw","expectedType","boolValue","intValue","floatValue","ValueFormatter","value","live","base","setLiveValuesEffect","StateEffect","LiveValueWidget","WidgetType","showChange","wrapper","formatted","valueSpan","other","liveValueDecorations","StateField","Decoration","decorations","tr","effect","buildDecorations","field","doc","liveValues","lines","pos","lineNum","line","lineEnd","widget","b","d","liveValueStyles","liveValuesExtension","updateLiveValues","view","STEditor","LitElement","Compartment","_changedProperties","resolve","changedProperties","EditorState","currentCode","_a","_b","_c","container","extensions","lineNumbers","highlightActiveLineGutter","highlightSpecialChars","history","foldGutter","drawSelection","indentOnInput","bracketMatching","closeBrackets","autocompletion","highlightActiveLine","highlightSelectionMatches","keymap","closeBracketsKeymap","defaultKeymap","searchKeymap","historyKeymap","foldKeymap","completionKeymap","indentWithTab","e","bindingSyntax","jsonData","err","selection","insertPos","code","html","css","__decorateClass","property","customElement","OnlineToolbar","_d","_e","_f","checked","keyword","name","text","createToken","WhiteSpace","Lexer","LineComment","BlockComment","Pragma","EndProgram","EndFunction","EndFunctionBlock","FunctionBlock","EndVar","VarInput","VarOutput","VarInOut","VarGlobal","EndIf","EndCase","EndFor","EndWhile","EndRepeat","Program","Function","Var","Constant","If","Then","Elsif","Else","Case","Of","For","To","By","Do","While","Repeat","Until","Return","Exit","Continue","At","And","Or","Xor","Not","Mod","True","False","TypeBool","TypeInt","TypeReal","TypeString","TypeTime","TypeByte","TimeLiteral","HexLiteral","BinaryLiteral","OctalLiteral","RealLiteral","IntegerLiteral","StringLiteral","IoAddress","Assign","Output","LessEqual","GreaterEqual","NotEqual","Less","Greater","Equal","Plus","Minus","Star","Slash","LParen","RParen","LBracket","RBracket","Colon","Semicolon","Comma","Dot","Range","Identifier","allTokens","STLexer","tokenize","result","STParser","CstParser","parserInstance","BaseVisitor","STVisitor","ctx","pragmas","programName","variables","vb","body","s","section","vd","decl","dataType","initialValue","content","colonIndex","typeName","condition","thenBranch","elsifBranches","cond","i","stmts","elseBranch","selector","cases","c","elseCase","values","cl","lhs","operator","allOps","a","op","parts","id","args","kind","valueExpr","address","ioAddress","tokens","first","last","key","item","visitor","parse","errors","lexResult","cst","STPanel","ProjectStorage","configEntryId","project","activeFile","errorCount","warningCount","file","newCode","fileId","editor","currentFile","editorCode","openFiles","newName","diagnostics","parseResult","analysis","analyzeDependencies","diag","transpile","deploy","HAApiClient","n","transpilerResult","api","deployResult","dependencies","dep","isPaused"],"mappings":";;;;;;;;;AAWO,MAAMA,IAAc;AAAA,EACzB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAEaC,IAAW;AAAA,EACtB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAEaC,IAAc;AAAA,EACzB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAEaC,IAAqB;AAAA,EAChC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAEaC,KAAa;AAAA,EACxB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,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"}